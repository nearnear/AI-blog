{"componentChunkName":"component---src-templates-blog-post-js","path":"/AI/NLP/transformer/","result":{"data":{"allMarkdownRemark":{"totalCount":26},"markdownRemark":{"id":"0db6b306-7fbb-5e1e-abb2-13d941036ef4","html":"<p>Paper:</p>\n<blockquote>\n<p>Vaswani et al., 2017, \"Attention is all you need\" (<a href=\"https://arxiv.org/abs/1706.03762\">Link to arxiv</a>)</p>\n</blockquote>\n<br>\n<br>\n<h2>0. Transformer</h2>\n<p>íŠ¸ëœìŠ¤í¬ë¨¸ëŠ” Seq2Seq ëª¨ë¸ê³¼ ë¹„ìŠ·í•œ ì¸ì½”ë”-ë””ì½”ë” êµ¬ì¡°ë¥¼ ê°–ê³  ìˆì§€ë§Œ, ë³´ë‹¤ ê¸´ ì‹œí€€ìŠ¤ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ë‹¤ë£°ìˆ˜ ìˆëŠ” ëª¨ë¸ë¡œ í™˜ì˜ë°›ì•˜ë‹¤. íŠ¸ëœìŠ¤í¬ë¨¸ëŠ” ìƒˆë¡œìš´ ì–´í…ì…˜ì„ ë„ì…í–ˆë‹¤. 2014ë…„ì— ë“±ì¥í•œ ì–´í…ì…˜(Bahdanau et al., 2014)ì´ RNN ë„¤íŠ¸ì›Œí¬ì˜ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¤ëŠ” í™œìš©ëœ ê²ƒê³¼ ë‹¬ë¦¬, 2017ë…„ì˜ ì–´í…ì…˜ì€ ì‹ ê²½ë§ì„ ì´ìš©í•˜ì§€ ì•Šê³  í–‰ë ¬ ê³±ìœ¼ë¡œ ì´ë£¨ì–´ì§„ ë°©ì‹ì„ ì œì•ˆí•˜ë©´ì„œ ìì—°ì–´ ì²˜ë¦¬ì— ìˆì–´ íšê¸°ì ì¸ ì„±ëŠ¥ í–¥ìƒì„ ë¶ˆëŸ¬ì™”ë‹¤.</p>\n<!--<figure>-->\n<!--    <a href=\"/imgs/post-imgs/transformer-structure.png\"><img src=\"/imgs/post-imgs/transformer-structure.png\"></a>-->\n<!--    <figcaption>The structure of transformer, Vaswani et al., 2017.-->\n<!--</figcaption>-->\n<!--</figure>-->\n<p>íŠ¸ëœìŠ¤í¬ë¨¸ ëª¨ë¸ì€ í¬ê²Œ ë´ì„œ ì™¼ìª½ì˜ ì¸ì½”ë”ì™€ ì˜¤ë¥¸ìª½ì˜ ë””ì½”ë”ë¥¼ ê°€ì§€ëŠ” êµ¬ì¡°ì´ë‹¤. RNN ëª¨ë¸ì—ì„œì™€ ë§ˆì°¬ê°€ì§€ë¡œ ì¸ì½”ë”ì˜ ê²°ê³¼ê°’ì„ ë””ì½”ë”ì˜ ì…ë ¥ê°’ê³¼ ê²°í•©í•´ì„œ ì—°ì‚°ì„ ê±°ì³ ê²°ê³¼ê°’ì„ ë„ì¶œí•œë‹¤. ë‹¤ë§Œ RNNê³¼ì˜ ì°¨ì´ì ì€ ì‹œí€€ìŠ¤ë¥¼ <strong>ë™ì‹œì—</strong> ì²˜ë¦¬í•œë‹¤ëŠ” ì ì´ë‹¤. ì¦‰ ì‹œí€€ìŠ¤ ëª¨ë¸ì²˜ëŸ¼ ì‹œí€€ìŠ¤ ë°ì´í„°ì— ìˆœì„œëŒ€ë¡œ ì ‘ê·¼í•´ì„œ í•˜ë‚˜ì”© ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì „ì²´ ì‹œí€€ìŠ¤ë¥¼ í•œ ë²ˆì— ì—°ì‚°í•œë‹¤. ë”°ë¼ì„œ ë¶„ì‚° ì—°ì‚°ì´ ìš©ì´í•˜ë©° RNN ëª¨ë¸ì—ì„œ ë°œìƒí•˜ëŠ” vanishing gradient í˜„ìƒì— íš¨ê³¼ì ìœ¼ë¡œ ëŒ€ì²˜í•´ì„œ ë³´ë‹¤ ê¸´ ì‹œí€€ìŠ¤ë¥¼ ë‹¤ë£° ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.</p>\n<p>íŠ¸ëœìŠ¤í¬ë¨¸ ë„¤íŠ¸ì›Œí¬ì— ì‚¬ìš©ë˜ëŠ” ì–´í…ì…˜ì€ í–‰ë ¬ê³±ì„ ì´ìš©í•œ ìˆœì°¨ì ì´ì§€ ì•Šì€ (ë”°ë¼ì„œ ë³‘ë ¬ ì—°ì‚°ì´ ê°€ëŠ¥í•œ) ì–´í…ì…˜ì´ë©°, ì´ ì–´í…ì…˜ì„ Scaled-Dot product ì–´í…ì…˜ì´ë¼ê³  í•œë‹¤.</p>\n<br>\n<h3>ğŸ”” Scaled-Dot prooduct Attention</h3>\n<p>Scaled-Dot prooduct ì–´í…ì…˜ì—ëŠ” ì„¸ê°œì˜ í–‰ë ¬ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span> ì…ë ¥ì´ í•„ìš”í•˜ë‹¤:</p>\n<ul>\n<li><span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span></span>, Queries : ë¹„êµí•˜ê³ ì í•˜ëŠ” ì‹œí€€ìŠ¤ë¡œ, í‚¤ Kì™€ ìœ ì‚¬ë„ë¥¼ ì¸¡ì •í•œë‹¤.</li>\n<li><span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span></span>, Keys : ë¹„êµ ëŒ€ìƒì´ ë˜ëŠ” ì‹œí€€ìŠ¤ë¡œ, ì¿¼ë¦¬ Qì™€ ìœ ì‚¬ë„ë¥¼ ì¸¡ì •í•œë‹¤.</li>\n<li><span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span>, Values : <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">QK</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span></span>ì˜ ê°€ì¤‘ì¹˜ê°€ ê³±í•´ì§€ëŠ” í–‰ë ¬ì´ë‹¤.</li>\n</ul>\n<p>ì–´í…ì…˜ì´ë€ í–‰ë ¬ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span></span>ì™€ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span></span>-<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span> ìŒì„ ê²°ê³¼ê°’ì— ë§¤í•‘í•˜ëŠ” í•¨ìˆ˜ë¡œ, ê²°ê³¼ê°’ì€ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span>ì˜ ê°€ì¤‘ì¹˜ í•©ìœ¼ë¡œ ê³„ì‚°ë˜ê³ , ê°ê°ì˜ ê°’ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span>ì— í• ë‹¹ëœ ê°€ì¤‘ì¹˜ëŠ” <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span></span></span></span></span>ì™€ ê·¸ì— ëŒ€ì‘í•˜ëŠ” <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span>ë¡œë¶€í„° ê³„ì‚°ëœë‹¤. ì´ ì–´í…ì…˜ì´ ì´ë¦„ ë¶™ì€ ì´ìœ ëŠ” ì–´í…ì…˜ì„ ì—°ì‚°í•˜ëŠ” ë°©ë²•ì— ìˆë‹¤.</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>A</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo stretchy=\"false\">(</mo><mi>Q</mi><mo separator=\"true\">,</mo><mi>K</mi><mo separator=\"true\">,</mo><mi>V</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>s</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy=\"false\">(</mo><mfrac><mrow><mi>Q</mi><mo>â‹…</mo><msup><mi>K</mi><mi>T</mi></msup></mrow><msqrt><msub><mi>d</mi><mi>k</mi></msub></msqrt></mfrac><mo stretchy=\"false\">)</mo><mo>â‹…</mo><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">Attention(Q, K, V) = softmax(\\frac{Q \\cdot K^T}{\\sqrt{d_k}}) \\cdot V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\">tt</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">n</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">Q</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.4483em;vertical-align:-0.93em;\"></span><span class=\"mord mathnormal\">so</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ma</span><span class=\"mord mathnormal\">x</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.5183em;\"><span style=\"top:-2.2528em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8572em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.8172em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.08em\" viewBox=\"0 0 400000 1080\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1828em;\"><span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">Q</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">â‹…</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.93em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">â‹…</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span></div>\n<p>ì²« ë²ˆì§¸ í–‰ë ¬ ê³±(dot product)ì€ ì¿¼ë¦¬ Qì™€ í‚¤ Kì˜ ìœ ì‚¬ë„ë¥¼ ë¶„ì„í•˜ê³ , ë‘ë²ˆì§¸ ê³±ì€ softmax í•¨ìˆ˜ê°’ìœ¼ë¡œ ì–»ì–´ì§„ ê°€ì¤‘ì¹˜ë¥¼ ë°œë¥˜ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span>ì— í• ë‹¹í•œë‹¤. <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span></span>ì™€ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span></span>ì˜ ê³±ì€ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span></span>ì˜ ì°¨ì› <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>d</mi><mi>k</mi></msub></mrow><annotation encoding=\"application/x-tex\">d_k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span>ì˜ ë£¨íŠ¸ë¡œ ì¡°ì •(scaled) í•˜ëŠ”ë°, ì´ ìŠ¤ì¼€ì¼ë§ì€ reguralizationíš¨ê³¼ë¥¼ ê°€ì§„ë‹¤. ê·¸ ë‹¤ìŒ softmax í•¨ìˆ˜ë¥¼ ê±°ì³ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span></span>ì™€ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span></span>ì˜ ìœ ì‚¬ë„ë¥¼ ê°€ì¤‘ì¹˜ë¡œ ë³€í™˜í•´ ë§ˆì§€ë§‰ìœ¼ë¡œ ê·¸ ê°’ì„ í–‰ë ¬ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span>ì— ë°˜ì˜í•´ ëª¨ë“  ì¿¼ë¦¬ì˜ ì–´í…ì…˜ì„ ì–»ì„ ìˆ˜ ìˆë‹¤.</p>\n<!--<figure>-->\n<!--    <a href=\"/imgs/post-imgs/transformer-attention.png\"><img src=\"/imgs/post-imgs/transformer-attention.png\"></a>-->\n<!--    <figcaption>Attention, Badnau et al., 2015.</figcaption>-->\n<!--</figure>-->\n<p>ì–´í…ì…˜ì€ ì¿¼ë¦¬ì™€ í‚¤ì˜ heatmapì„ ìƒì„±í•˜ëŠ” ê²ƒê³¼ ê°™ë‹¤. ì „ì²´ ì‹œí€€ìŠ¤ë¥¼ í•œ ë²ˆì— ë‹¨ì–´ ìŒ ë‹¨ìœ„ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>q</mi><mo separator=\"true\">,</mo><mi>k</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(q, k)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose\">)</span></span></span></span></span>ë¡œ ì‚´í´ë³´ê¸° ë•Œë¬¸ì—, ë‹¨ì–´ê°€ ë¬¸ì¥ì—ì„œ ë“±ì¥í•˜ëŠ” ìˆœì„œì— ê´€ê³„ì—†ì´ ìœ ì‚¬ë„ë¥¼ ê³„ì‚°í•  ìˆ˜ ìˆë‹¤. ìœ„ì˜ ì˜ˆì²˜ëŸ¼ ì–´ìˆœì´ ë‹¤ë¥¸ ì˜ì–´ì™€ í”„ë‘ìŠ¤ì–´ ë¬¸ì¥ì—ì„œë„ ë‹¨ì–´ì˜ ëŒ€ì‘ ê´€ê³„ë¥¼ ì œëŒ€ë¡œ íŒŒì•…í•  ìˆ˜ ìˆë‹¤.</p>\n<br>\n<h3>ğŸ”” Multi-Head Attention</h3>\n<!--<figure>-->\n<!--    <a href=\"/imgs/post-imgs/transformer-multi-head-attention.png\"><img src=\"/imgs/post-imgs/transformer-multi-head-attention.png\"></a>-->\n<!--    <figcaption>Multi-Head Attention, from deeplearning.ai.</figcaption>-->\n<!--</figure>-->\n<p>íŠ¸ëœìŠ¤í¬ë¨¸ì˜ ì–´í…ì…˜ì˜ ë˜ë‹¤ë¥¸ íŠ¹ì§•ì€ ì–´í…ì…˜ì´ ë¨¸ë¦¬(heads)ë¥¼ ì—¬ëŸ¬ê°œ ê°€ì§„ë‹¤ëŠ” ê²ƒì´ë‹¤. ì…ë ¥ê°’ì— ëŒ€í•´ ì–´í…ì…˜ì„ ì—¬ëŸ¬ë²ˆ ìˆ˜í–‰í•œ í›„ ê²°ê³¼ë¥¼ ê²°í•©(concatenate)í•´ì„œ ìµœì¢…ì ìœ¼ë¡œ í•˜ë‚˜ì˜ í–‰ë ¬ì„ ë§Œë“œëŠ” ê²ƒì„ ëœ»í•œë‹¤. <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>d</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">d_{model}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span> ì°¨ì›ì˜ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span>ì— ëŒ€í•´ ì¼íšŒ ì–´í…ì…˜ì„ ì ìš©í•˜ëŠ” ëŒ€ì‹  <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span>ë¥¼ <code>n_heads</code>ë²ˆ ì„ í˜• íˆ¬ì‚¬(linear projection)í•´ì„œ ì„œë¡œë‹¤ë¥¸ í•™ìŠµëœ ì„ í˜• íˆ¬ì‚¬ë“¤ì— ëŒ€í•´ ì–´í…ì…˜ì„ ì ìš©í•œë‹¤. ê° ì„ í˜• íˆ¬ì‚¬ë¥¼ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span></span>ì— ëŒ€í•´ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>W</mi><mi>Q</mi></msup></mrow><annotation encoding=\"application/x-tex\">W^Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8413em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">Q</span></span></span></span></span></span></span></span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span></span>ì— ëŒ€í•´ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>W</mi><mi>K</mi></msup></mrow><annotation encoding=\"application/x-tex\">W^K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8413em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">K</span></span></span></span></span></span></span></span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span>ì— ëŒ€í•´ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>W</mi><mi>V</mi></msup></mrow><annotation encoding=\"application/x-tex\">W^V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8413em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span></span></span></span></span></span></span></span>ë¼ê³  í•˜ë©° ê°ê° <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msub><mi>n</mi><mrow><mi>s</mi><mi>e</mi><mi>q</mi></mrow></msub><mo separator=\"true\">,</mo><msub><mi>d</mi><mi>k</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(n_{seq}, d_k)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">se</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">q</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msub><mi>n</mi><mrow><mi>s</mi><mi>e</mi><mi>q</mi></mrow></msub><mo separator=\"true\">,</mo><msub><mi>d</mi><mi>k</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(n_{seq}, d_k)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">se</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">q</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msub><mi>n</mi><mrow><mi>s</mi><mi>e</mi><mi>q</mi></mrow></msub><mo separator=\"true\">,</mo><msub><mi>d</mi><mi>v</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(n_{seq}, d_v)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">se</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">q</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span> ì°¨ì›ì„ ê°€ì§„ë‹¤. ì–´í…ì…˜ì„ ì ìš©í•˜ë©´ í•œê°œì˜ ê²°ê³¼ê°’ì— ëŒ€í•´ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msub><mi>n</mi><mrow><mi>s</mi><mi>e</mi><mi>q</mi></mrow></msub><mo separator=\"true\">,</mo><msub><mi>d</mi><mi>v</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(n_{seq}, d_v)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">se</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">q</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span> ì°¨ì›ì„ ê°€ì§€ë¯€ë¡œ <code>n_heads</code>ê°œì˜ ê²°ê³¼ê°’ì„ ê²°í•©í•œ í–‰ë ¬ ë‹¤ì‹œ ì„ í˜• íˆ¬ì‚¬í•´ì„œ ì–´í…ì…˜ ê²°ê³¼ê°’ì„ ì–»ëŠ”ë‹¤. ë§¤ë²ˆ í•™ìŠµí•  ë•Œë§ˆë‹¤ ë‹¤ë¥¸ ê°€ì¤‘ì¹˜ë¥¼ ê°€ì§€ë¯€ë¡œ ì—¬ëŸ¬ë²ˆ ì–´í…ì…˜ì„ ì ìš©í•¨ìœ¼ë¡œì„œ ì‹œí€€ìŠ¤ ë°ì´í„° ì‚¬ì´ì˜ ë‹¤ì–‘í•œ ê´€ê³„ë¥¼ í•™ìŠµí•  ìˆ˜ ìˆë‹¤. ì´ë•Œ ì—¬ëŸ¬ë²ˆì˜ ì–´í…ì…˜ì„ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰í•´ì•¼ í•  í•„ìš”ê°€ ì—†ìœ¼ë¯€ë¡œ ë³‘ë ¬ ì—°ì‚°ì„ í•˜ê¸° ìš©ì´í•œ êµ¬ì¡°ë‹¤.</p>\n<br>\n<p>ğŸ“‚ ë‹¤ìŒ ì½”ë“œëŠ” Trax <code>SplitIntoHeads</code>ì™€ <code>MergeHeads</code> ë©”ì„œë“œë¡œ, Multi-Head ì–´í…ì…˜ì˜ ì¼ë¶€ë¶„ì„ êµ¬í˜„í•œë‹¤.</p>\n<pre class=\"grvsc-container abyss\" data-language=\"python\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">SplitIntoHeads</span><span class=\"mtk1\">(</span><span class=\"mtk19 mtki\">n_heads</span><span class=\"mtk1\">, </span><span class=\"mtk19 mtki\">merged_batch_and_head</span><span class=\"mtk7\">=</span><span class=\"mtk4\">True</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk11\">&quot;&quot;&quot;Returns a layer that reshapes an array for multi-head computation.&quot;&quot;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">f</span><span class=\"mtk1\">(</span><span class=\"mtk19 mtki\">x</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    batch_size, seq_len, d_feature </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> x.shape</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> d_feature </span><span class=\"mtk7\">%</span><span class=\"mtk1\"> n_heads </span><span class=\"mtk7\">!=</span><span class=\"mtk1\"> </span><span class=\"mtk4\">0</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">raise</span><span class=\"mtk1\"> </span><span class=\"mtk15 mtki\">ValueError</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk15 mtki\">f</span><span class=\"mtk11\">&#39;Feature embedding dimensionality (</span><span class=\"mtk4\">{</span><span class=\"mtk1\">d_feature</span><span class=\"mtk4\">}</span><span class=\"mtk11\">) is not a multiple&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk15 mtki\">f</span><span class=\"mtk11\">&#39; of the requested number of attention heads (</span><span class=\"mtk4\">{</span><span class=\"mtk1\">n_heads</span><span class=\"mtk4\">}</span><span class=\"mtk11\">).&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    d_head </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> d_feature </span><span class=\"mtk7\">//</span><span class=\"mtk1\"> n_heads</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># (b_size, seq_len, d_feature) --&gt; (b_size*n_heads, seq_len, d_head)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    x </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> x.reshape((batch_size, seq_len, n_heads, d_head))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    x </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> x.transpose((</span><span class=\"mtk4\">0</span><span class=\"mtk1\">, </span><span class=\"mtk4\">2</span><span class=\"mtk1\">, </span><span class=\"mtk4\">1</span><span class=\"mtk1\">, </span><span class=\"mtk4\">3</span><span class=\"mtk1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> merged_batch_and_head:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      x </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> x.reshape((batch_size </span><span class=\"mtk7\">*</span><span class=\"mtk1\"> n_heads, seq_len, d_head))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> x</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> Fn(</span><span class=\"mtk11\">&#39;SplitIntoHeads&#39;</span><span class=\"mtk1\">, f)</span></span></span></code></pre>\n<p><code>SplitIntoHeads</code>ëŠ” <code>d_feature</code>(ê·¸ë¦¼ì—ì„œëŠ” <code>d_model</code>)ê°€ Headì˜ ê°œìˆ˜ <code>n_heads</code>ì˜ ì •ìˆ˜ë°°ì¼ ê²ƒì„ ê°•ì œí•œë‹¤. ìœ„ì˜ ê·¸ë¦¼ì²˜ëŸ¼ <code>(batch, seq_len, d_feature)</code>ì„ ì…ë ¥ë°›ì•„ <code>(b_size*n_heads, seq_len, d_head)</code>ì°¨ì›ì„ ì¶œë ¥í•˜ê³  ìˆë‹¤. ê·¸ ë‹¤ìŒ <code>PureAttention</code>ì²˜ëŸ¼ 1ê°œ Headì— ëŒ€í•œ ì–´í…ì…˜ì„ <code>n_heads</code>ë§Œí¼ ìˆ˜í–‰í•œ í›„, ì—¬ëŸ¬ Headë¥¼ <code>MergeHeads</code>ë¡œ ê²°í•©í•œë‹¤.</p>\n<pre class=\"grvsc-container abyss\" data-language=\"python\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">MergeHeads</span><span class=\"mtk1\">(</span><span class=\"mtk19 mtki\">n_heads</span><span class=\"mtk1\">, </span><span class=\"mtk19 mtki\">merged_batch_and_head</span><span class=\"mtk7\">=</span><span class=\"mtk4\">True</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk11\">&quot;&quot;&quot;Returns a layer that rejoins heads, after multi-head computation.&quot;&quot;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">f</span><span class=\"mtk1\">(</span><span class=\"mtk19 mtki\">x</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> merged_batch_and_head:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      dim_0, seq_len, d_head </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> x.shape</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> dim_0 </span><span class=\"mtk7\">%</span><span class=\"mtk1\"> n_heads </span><span class=\"mtk7\">!=</span><span class=\"mtk1\"> </span><span class=\"mtk4\">0</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">raise</span><span class=\"mtk1\"> </span><span class=\"mtk15 mtki\">ValueError</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15 mtki\">f</span><span class=\"mtk11\">&quot;Array&#39;s leading dimension (</span><span class=\"mtk4\">{</span><span class=\"mtk1\">dim_0</span><span class=\"mtk4\">}</span><span class=\"mtk11\">) is not a multiple of the&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15 mtki\">f</span><span class=\"mtk11\">&quot; number of attention heads (</span><span class=\"mtk4\">{</span><span class=\"mtk1\">n_heads</span><span class=\"mtk4\">}</span><span class=\"mtk11\">).&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      batch_size </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> dim_0 </span><span class=\"mtk7\">//</span><span class=\"mtk1\"> n_heads</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      x </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> x.reshape((batch_size, n_heads, seq_len, d_head))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">else</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      batch_size, _, seq_len, d_head </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> x.shape</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># (b_size, n_heads, seq_len, d_head) --&gt; (b_size, seq_len, d_feature)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    x </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> x.transpose((</span><span class=\"mtk4\">0</span><span class=\"mtk1\">, </span><span class=\"mtk4\">2</span><span class=\"mtk1\">, </span><span class=\"mtk4\">1</span><span class=\"mtk1\">, </span><span class=\"mtk4\">3</span><span class=\"mtk1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    x </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> x.reshape((batch_size, seq_len, n_heads </span><span class=\"mtk7\">*</span><span class=\"mtk1\"> d_head))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> x</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> Fn(</span><span class=\"mtk11\">&#39;MergeHeads&#39;</span><span class=\"mtk1\">, f)</span></span></span></code></pre>\n<p>í•¨ìˆ˜ <code>f</code>ëŠ” <code>(batch_size, n_heads, seq_len, d_head)</code> ì°¨ì›ì˜ ì…ë ¥ê°’ì„ ì–´í…ì…˜ ë¸”ëŸ­ì˜ ì…ë ¥ê°’ ì°¨ì› <code>(b_size, seq_len, d_feature)</code>ë¡œ ë³€í˜•í•´ì„œ ë°˜í™˜í•œë‹¤.</p>\n<br>\n<br>\n<h2>1. Encoder</h2>\n<p>ë„ë¦¬ ì“°ì´ëŠ” íŠ¸ëœìŠ¤í¬ë¨¸ ì‚¬ì „í›ˆë ¨ ëª¨ë¸ì¸ BERTì˜ ê²½ìš° ì¸ì½”ë”ë§Œ (<code>bert-large</code>ì˜  ê²½ìš°) 24ê°œ ìŒ“ì€ ë„¤íŠ¸ì›Œí¬ë‹¤. LSTMì„ ìƒê°í•´ ë³´ë©´ ì¸ì½”ë”ì˜ êµ¬ì¡°ëŠ” ìƒëŒ€ì ìœ¼ë¡œ ë‹¨ìˆœí•´ ë³´ì´ì§€ë§Œ, ì¸ì½”ë”ë§Œìœ¼ë¡œë„ ë§ì€ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŒì„ ì•Œ ìˆ˜ ìˆë‹¤.</p>\n<!--<figure>-->\n<!--    <a href=\"/imgs/post-imgs/transformer-encoder.png\"><img src=\"/imgs/post-imgs/transformer-encoder.png\"></a>-->\n<!--    <figcaption>Encoder structure, from deeplearning.ai.</figcaption>-->\n<!--</figure>-->\n<p>ì¸ì½”ë”ëŠ” í¬ê²Œ <strong>ë‘ê°œì˜ ë ˆì´ì–´</strong>ë¡œ êµ¬ì„±ëœë‹¤. Multi-Head Attentionê³¼ FeedForwardì´ë‹¤. FeedForwardëŠ” ì¼ë ¨ì˜ í›ˆë ¨ ê°€ëŠ¥í•œ ì‹ ê²½ë§ìœ¼ë¡œ êµ¬ì„±ëœ ë¸”ëŸ­ì´ë‹¤. 0ï¸âƒ£ ì…ë ¥ê°’ì„ Embeddingí•˜ê³  Positional Encodingì„ ì ìš©í•œ í›„ì—, í•œ ê°œì˜ <strong>ì¸ì½”ë” ë¸”ëŸ­</strong>ì€ 1ï¸âƒ£ Residualì„ ì ìš©í•œ Multi-Head Attentionì„ ì‹¤í–‰í•˜ê³  2ï¸âƒ£ ë‹¤ì‹œ Residualì„ ì ìš©í•œ FeedForward ë ˆì´ì–´ë¥¼ ì‹¤í–‰í•œë‹¤. ëª¨ë¸ì„ ê¹Šê²Œ ë§Œë“¤ê¸° ìœ„í•´ ì´ ì¸ì½”ë” ë¸”ëŸ­ì„ ì—¬ëŸ¬ë²ˆ ì‹¤í–‰í•œë‹¤.</p>\n<p>Residual ë ˆì´ì–´ëŠ” í•¨ìˆ˜ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi><mi>n</mi><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">Fn(x_1, x_2, ...)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal\">n</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">...</span><span class=\"mclose\">)</span></span></span></span></span>ì— ëŒ€í•´ ë‹¤ìŒì„ ëœ»í•œë‹¤.</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>R</mi><mi>e</mi><mi>s</mi><mi>i</mi><mi>d</mi><mi>u</mi><mi>a</mi><mi>l</mi><mo stretchy=\"false\">(</mo><mi>F</mi><mi>n</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>F</mi><mi>n</mi><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mo stretchy=\"false\">)</mo><mo>+</mo><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">Residual(Fn)(x_1, x_2, ...) = Fn(x_1, x_2, ...) + x_1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mord mathnormal\">es</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">...</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal\">n</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">...</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span></div>\n<p>ì¦‰ ì…ë ¥ê°’ì˜ ì²«ë²ˆì§¸ ê°’ì„ í•¨ìˆ˜ì˜ ê²°ê³¼ê°’ì— ë”í•˜ëŠ” ê¸°ëŠ¥ì„ í•œë‹¤. Residual ë ˆì´ì–´ë¥¼ ì ìš©í•˜ëŠ” ì´ìœ ëŠ” shortcut ì—°ê²° ê¸°ëŠ¥ì„ í•˜ê¸° ë•Œë¬¸ì´ë‹¤. íŠ¹íˆ ê¹Šì€ ë„¤íŠ¸ì›Œí¬ë¥¼ í•™ìŠµí•  ë•Œ Residualì´ íš¨ê³¼ì ì„ì´ ê²€ì¦ë˜ì—ˆë‹¤.</p>\n<blockquote>\n<p>Further study - Residual ë„¤íŠ¸ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ  : <a href=\"https://arxiv.org/pdf/1512.03385.pdf\">He et al., 2015</a></p>\n</blockquote>\n<br>\n<p>ğŸ“‚ ë‹¤ìŒ ì½”ë“œëŠ” Trax ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ <code>TransformerEncoder</code> ëª¨ë¸ì´ë‹¤.</p>\n<pre class=\"grvsc-container abyss\" data-language=\"python\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">TransformerEncoder</span><span class=\"mtk1\">(</span><span class=\"mtk19 mtki\">vocab_size</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                       </span><span class=\"mtk19 mtki\">n_classes</span><span class=\"mtk7\">=</span><span class=\"mtk4\">10</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                       </span><span class=\"mtk19 mtki\">d_model</span><span class=\"mtk7\">=</span><span class=\"mtk4\">D_MODEL</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                       </span><span class=\"mtk19 mtki\">d_ff</span><span class=\"mtk7\">=</span><span class=\"mtk4\">D_FF</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                       </span><span class=\"mtk19 mtki\">n_layers</span><span class=\"mtk7\">=</span><span class=\"mtk4\">N_LAYERS</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                       </span><span class=\"mtk19 mtki\">n_heads</span><span class=\"mtk7\">=</span><span class=\"mtk4\">N_HEADS</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                       </span><span class=\"mtk19 mtki\">max_len</span><span class=\"mtk7\">=</span><span class=\"mtk4\">MAX_SEQUENCE_LENGTH</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                       </span><span class=\"mtk19 mtki\">dropout</span><span class=\"mtk7\">=</span><span class=\"mtk4\">DROPOUT_RATE</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                       </span><span class=\"mtk19 mtki\">dropout_shared_axes</span><span class=\"mtk7\">=</span><span class=\"mtk4\">DROPOUT_SHARED_AXES</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                       </span><span class=\"mtk19 mtki\">mode</span><span class=\"mtk7\">=</span><span class=\"mtk4\">MODE</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                       </span><span class=\"mtk19 mtki\">ff_activation</span><span class=\"mtk7\">=</span><span class=\"mtk4\">FF_ACTIVATION_TYPE</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">_Dropout</span><span class=\"mtk1\">():</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> tl.Dropout(</span><span class=\"mtk19 mtki\">rate</span><span class=\"mtk7\">=</span><span class=\"mtk1\">dropout, </span><span class=\"mtk19 mtki\">shared_axes</span><span class=\"mtk7\">=</span><span class=\"mtk1\">dropout_shared_axes, </span><span class=\"mtk19 mtki\">mode</span><span class=\"mtk7\">=</span><span class=\"mtk1\">mode)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">_EncBlock</span><span class=\"mtk1\">():</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> _EncoderBlock(d_model, d_ff, n_heads, dropout, dropout_shared_axes,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                         mode, ff_activation)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> tl.Serial(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.Branch([], tl.PaddingMask()),  </span><span class=\"mtk3\"># Creates masks from copy of the tokens.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.Embedding(vocab_size, d_model),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      _Dropout(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.PositionalEncoding(</span><span class=\"mtk19 mtki\">max_len</span><span class=\"mtk7\">=</span><span class=\"mtk1\">max_len),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      [_EncBlock() </span><span class=\"mtk7\">for</span><span class=\"mtk1\"> _ </span><span class=\"mtk7\">in</span><span class=\"mtk1\"> </span><span class=\"mtk15\">range</span><span class=\"mtk1\">(n_layers)],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.Select([</span><span class=\"mtk4\">0</span><span class=\"mtk1\">], </span><span class=\"mtk19 mtki\">n_in</span><span class=\"mtk7\">=</span><span class=\"mtk4\">2</span><span class=\"mtk1\">),  </span><span class=\"mtk3\"># Drops the masks.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.LayerNorm(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.Mean(</span><span class=\"mtk19 mtki\">axis</span><span class=\"mtk7\">=</span><span class=\"mtk4\">1</span><span class=\"mtk1\">),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.Dense(n_classes),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  )</span></span></span></code></pre>\n<p><code>TransformerEncoder</code>ëŠ” í† í°í™”ëœ í…ìŠ¤íŠ¸ë¥¼ <code>n_classes</code>ê°œë¡œ ë¶„ë¥˜í•œë‹¤. í•¨ìˆ˜ ë°˜í™˜ê°’ì˜ ì²«ì¤„ì— ë“±ì¥í•˜ëŠ” <code>tl.Branch</code>ëŠ” ì…ë ¥ê°’ì„ ë°›ì•„ì„œ ê°ê°ì˜ í•¨ìˆ˜ë¥¼ ë³‘ë ¬ì ìœ¼ë¡œ ì‹¤í–‰í•œë‹¤. ì¦‰ ì…ë ¥ê°’ì„ ë¦¬ìŠ¤íŠ¸<code>[]</code>ë¡œ ë§Œë“  ê°’ê³¼ íŒ¨ë”©ë§ˆìŠ¤í¬ <code>tl.PaddingMask()</code> ê°’ ë‘ê°œë¥¼ ë°˜í™˜í•  ê²ƒì´ë‹¤. ë‘ ê°’ ëª¨ë‘ ì„ë² ë”©ê³¼ positional encodingì„ ê±°ì³ ì¸ì½”ë” ë¸”ëŸ­ì— ì…ë ¥ëœë‹¤. ì¸ì½”ë” ë¸”ëŸ­ì˜ ì½”ë“œì—ì„œ ë°ì´í„°ì™€ ë§ˆìŠ¤í¬ ìŒ <code>(activations, mask)</code>ì„ ì…ë ¥ë°›ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>\n<pre class=\"grvsc-container abyss\" data-language=\"python\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">_EncoderBlock</span><span class=\"mtk1\">(</span><span class=\"mtk19 mtki\">d_model</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                  </span><span class=\"mtk19 mtki\">d_ff</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                  </span><span class=\"mtk19 mtki\">n_heads</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                  </span><span class=\"mtk19 mtki\">dropout</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                  </span><span class=\"mtk19 mtki\">dropout_shared_axes</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                  </span><span class=\"mtk19 mtki\">mode</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                  </span><span class=\"mtk19 mtki\">ff_activation</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk11\">&quot;&quot;&quot;Returns a list of layers that implements a Transformer encoder block.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  The input to the block is a pair (activations, mask) where the mask was</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  created from the original source tokens to prevent attending to the padding</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  part of the input. The block&#39;s outputs are the same type/shape as its inputs,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  so that multiple blocks can be chained together.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  &quot;&quot;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">_Attention</span><span class=\"mtk1\">():</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> tl.Attention(d_model, </span><span class=\"mtk19 mtki\">n_heads</span><span class=\"mtk7\">=</span><span class=\"mtk1\">n_heads, </span><span class=\"mtk19 mtki\">dropout</span><span class=\"mtk7\">=</span><span class=\"mtk1\">dropout, </span><span class=\"mtk19 mtki\">mode</span><span class=\"mtk7\">=</span><span class=\"mtk1\">mode)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.Residual(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          tl.LayerNorm(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          _Attention(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          _Dropout(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      ),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.Residual(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          tl.LayerNorm(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          _FFBlock(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          _Dropout(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      ),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  ]</span></span></span></code></pre>\n<p>ì—¬ê¸°ì„œ <code>tl.Attention</code>ì€ <code>n_heads</code>ê°œì˜ ë¨¸ë¦¬ë¥¼ ê°€ì§€ëŠ” multi-head ì…€í”„-ì–´í…ì…˜ì´ë©°, Attention ë ˆì´ì–´ì™€ FeedForward ë¸”ëŸ­ì´ Residualì„ ê±°ì¹˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì–´í…ì…˜ ë¸”ëŸ­ì„ ì§€ë‚œ í›„ì—ëŠ” ë§ˆìŠ¤í¬ê°€ í•„ìš” ì—†ìœ¼ë¯€ë¡œ <code>tl.Select()</code>ë¡œ <code>(activations, mask)</code>ìŒì—ì„œ ì•ì˜ ê°’ë§Œ ì·¨í•˜ê³  <code>tl.LayerNorm()</code>ê³¼ ê°™ì€ ì¿¼ë¦¬ì— í•´ë‹¹í•˜ëŠ” ì—´ì— ëŒ€í•œ ë§ì…ˆ <code>tl.Mean(axis=1)</code>, ê·¸ë¦¬ê³  <code>n_classes</code>ê°œì˜ <code>tl.Dense()</code> ì¸µì„ ê±°ì³ ë§ˆë¬´ë¦¬í•œë‹¤.</p>\n<br>\n<h3>ğŸ”† Dimensionality Setting</h3>\n<p>Residual ë ˆì´ì–´ë¥¼ ì ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì–´í…ì…˜ì˜ ì…ë ¥ê°’ê³¼ ê²°ê³¼ê°’ì˜ ì°¨ì›ì´ ê°™ì•„ì•¼í•œë‹¤. ì•ì˜ Multi-Head Attention ê·¸ë¦¼ì„ ì°¸ê³ í•˜ì—¬ ë°°ì¹˜ í¬ê¸°ë¥¼ <code>batch</code>, ì…ë ¥ ì‹œí€€ìŠ¤ ê¸¸ì´ë¥¼ <code>length</code>, ê·¸ë¦¬ê³  ì–´í…ì…˜ì˜ ì°¨ì›ì„ <code>d_model</code>ë¡œ ì„¤ì •í•˜ì. Q, K, Vê°€ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>b</mi><mi>a</mi><mi>t</mi><mi>c</mi><mi>h</mi><mo separator=\"true\">,</mo><mi>l</mi><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>h</mi><mo separator=\"true\">,</mo><msub><mi>d</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(batch, length, d_{model})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">ba</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">h</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span> ì°¨ì›ì„ ê°€ì§€ë©°, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>W</mi><mi>Q</mi></msup></mrow><annotation encoding=\"application/x-tex\">W^Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8413em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">Q</span></span></span></span></span></span></span></span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>W</mi><mi>K</mi></msup></mrow><annotation encoding=\"application/x-tex\">W^K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8413em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">K</span></span></span></span></span></span></span></span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>W</mi><mi>V</mi></msup></mrow><annotation encoding=\"application/x-tex\">W^V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8413em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span></span></span></span></span></span></span></span>ëŠ” ê°ê° <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>b</mi><mi>a</mi><mi>t</mi><mi>c</mi><mi>h</mi><mo separator=\"true\">,</mo><mi>l</mi><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>h</mi><mo separator=\"true\">,</mo><msub><mi>d</mi><mi>k</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(batch, length, d_k)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">ba</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">h</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>b</mi><mi>a</mi><mi>t</mi><mi>c</mi><mi>h</mi><mo separator=\"true\">,</mo><mi>l</mi><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>h</mi><mo separator=\"true\">,</mo><msub><mi>d</mi><mi>k</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(batch, length, d_k)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">ba</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">h</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>b</mi><mi>a</mi><mi>t</mi><mi>c</mi><mi>h</mi><mo separator=\"true\">,</mo><mi>l</mi><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>h</mi><mo separator=\"true\">,</mo><msub><mi>d</mi><mi>v</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(batch, length, d_v)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">ba</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">h</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span> ì°¨ì›ì´ë¼ê³  í•˜ì. ìœ„ì˜ ì„¤ì •ì—ì„œ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>d</mi><mi>k</mi></msub><mo>=</mo><msub><mi>d</mi><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">d_k = d_v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span>ë¡œ ë‘ë©°, ê·¸ë¦¼ì—ì„œëŠ” ì´ ê°’ì´ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>d</mi><mrow><mi>h</mi><mi>e</mi><mi>a</mi><mi>d</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">d_{head}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">h</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">d</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span>ë¡œ ë‚˜íƒ€ë‚˜ ìˆë‹¤. ì–´í…ì…˜ì„ ìˆ˜í–‰í•˜ê³  ë‚œ í›„ ië²ˆ ì§¸ ì–´í…ì…˜ì€ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>Z</mi><mi>i</mi></msub><mo>âˆˆ</mo><mo stretchy=\"false\">(</mo><mi>b</mi><mi>a</mi><mi>t</mi><mi>c</mi><mi>h</mi><mo separator=\"true\">,</mo><mi>l</mi><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>h</mi><mo separator=\"true\">,</mo><msub><mi>d</mi><mi>v</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">Z_i \\in (batch, length, d_v)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">Z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">âˆˆ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">ba</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">h</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span> ì°¨ì›ì´ ë˜ëŠ”ë°, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>n</mi><mrow><mi>h</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">n_{heads}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">h</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\">s</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span>ê°œì˜ ì–´í…ì…˜ì„ ê²°í•©í•˜ê³  ë‚œ í›„ ì²˜ìŒ ì…ë ¥ê°’ê³¼ ê°™ì€ ì°¨ì›ì„ ì–»ê¸° ìœ„í•´ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>n</mi><mrow><mi>h</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi></mrow></msub><mo>=</mo><msub><mi>d</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub><mi mathvariant=\"normal\">/</mi><msub><mi>d</mi><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\"> n_{heads} = d_{model} / d_v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">h</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\">s</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">/</span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span>ë¡œ ì„¤ì •í•œë‹¤. ìš”ì•½í•˜ë©´:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>d</mi><mi>k</mi></msub><mo>=</mo><msub><mi>d</mi><mi>v</mi></msub><mo>=</mo><msub><mi>d</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub><mi mathvariant=\"normal\">/</mi><msub><mi>n</mi><mrow><mi>h</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">d_k = d_v = d_{model} / n_{heads}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">/</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">h</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\">s</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span></div>\n<br>\n<h3>ğŸ”† Positional Encoding</h3>\n<p>ì¸ì½”ë”©ì— ì•ì„œ, ë‹¨ìˆœíˆ ë‹¨ì–´ ì„ë² ë”©ì„ í†µí•´ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><annotation encoding=\"application/x-tex\">QK^T</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0358em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span></span></span></span></span> 2ì°¨ì› í–‰ë ¬ì„ ê³„ì‚°í•˜ë©´ ì‹œí€€ìŠ¤ ëª¨ë¸ê³¼ ë‹¬ë¦¬ ë‹¨ì–´ì˜ ë¬¸ì¥ ë‚´ ìœ„ì¹˜ ì •ë³´ë¥¼ ë°˜ì˜í•  ìˆ˜ ì—†ë‹¤. ê·¸ëŸ¬ë‚˜ ì–´ìˆœì€ ë§¥ë½ì„ íŒŒì•…í•˜ëŠ”ë°ì— ì¤‘ìš”í•œ ë‹¨ì„œê°€ ëœë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë¬¸ì¥ ë‚´ì—ì„œ ê°™ì€ ë‹¨ì–´ê°€ ë“±ì¥í•´ë„ ê° ë‹¨ì–´ëŠ” ë‹¤ë¥¸ ì˜ë¯¸ë¥¼ ê°€ë¦¬í‚¬ ìˆ˜ ìˆê³ , ì–¸ì–´ë§ˆë‹¤ ë¬¸ë²• êµ¬ì¡°ì— ë”°ë¼ ì–´ìˆœì´ ë‹¤ë¥´ë©°, ê°™ì€ ë‹¨ì–´ë¥¼ ì‚¬ìš©í•´ë„ ì–´ìˆœì— ë”°ë¼ ë‹¤ë¥¸ ì˜ë¯¸ë¥¼ ë‚´í¬í•  ìˆ˜ ìˆë‹¤.</p>\n<p>ë”°ë¼ì„œ ìœ„ì¹˜ ì •ë³´ë¥¼ ë°˜ì˜í•˜ê¸° ìœ„í•´ ìœ„ì¹˜ì— ë”°ë¥¸ ì„ì˜ì˜ ê°’ì„ ì„¤ì •í•´ Q, Kì™€ Vì˜ ì„ë² ë”©ì— <strong>ë”í•˜ëŠ”</strong>ë°, ì´ ê²ƒì„ positional encodingì´ë¼ê³  í•œë‹¤. Traxì—ì„œëŠ” ì—¬ëŸ¬ê°€ì§€ positional encoding ë°©ë²•ì„ ì§€ì›í•˜ê³  ìˆëŠ”ë° (<a href=\"https://trax-ml.readthedocs.io/en/latest/trax.layers.html?highlight=positional%20encoding#module-trax.layers.research.position_encodings\">link</a>), ì› ë…¼ë¬¸ì—ì„œëŠ” ì°¨ì› <code>i</code>ì™€ ìœ„ì¹˜ <code>pos</code>ì— ëŒ€í•œ sine ê³¡ì„ ìœ¼ë¡œ í‘œí˜„í–ˆë‹¤.</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.25em\" columnalign=\"right left\" columnspacing=\"0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>P</mi><msub><mi>E</mi><mrow><mo stretchy=\"false\">(</mo><mi>p</mi><mi>o</mi><mi>s</mi><mo separator=\"true\">,</mo><mn>2</mn><mi>i</mi><mo stretchy=\"false\">)</mo></mrow></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy=\"false\">(</mo><mi>p</mi><mi>o</mi><mi>s</mi><mi mathvariant=\"normal\">/</mi><mn>1000</mn><msup><mn>0</mn><mrow><mn>2</mn><mi>i</mi><mi mathvariant=\"normal\">/</mi><msub><mi>d</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub></mrow></msup><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>P</mi><msub><mi>E</mi><mrow><mo stretchy=\"false\">(</mo><mi>p</mi><mi>o</mi><mi>s</mi><mo separator=\"true\">,</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy=\"false\">(</mo><mi>p</mi><mi>o</mi><mi>s</mi><mi mathvariant=\"normal\">/</mi><mn>1000</mn><msup><mn>0</mn><mrow><mn>2</mn><mi>i</mi><mi mathvariant=\"normal\">/</mi><msub><mi>d</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub></mrow></msup><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{aligned}\nPE_{(pos,2i)} &#x26;= sin(pos/10000^{2i/d_{model}}) \\\\\nPE_{(pos,2i+1)} &#x26;= cos(pos/10000^{2i/d_{model}})\n\\end{aligned}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:3.196em;vertical-align:-1.348em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.848em;\"><span style=\"top:-3.91em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.5198em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\">p</span><span class=\"mord mathnormal mtight\">os</span><span class=\"mpunct mtight\">,</span><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3552em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.312em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.5198em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\">p</span><span class=\"mord mathnormal mtight\">os</span><span class=\"mpunct mtight\">,</span><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3552em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.348em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.848em;\"><span style=\"top:-3.91em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">in</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">os</span><span class=\"mord\">/1000</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.938em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mord mtight\">/</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3488em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1512em;\"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span><span style=\"top:-2.312em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">cos</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">os</span><span class=\"mord\">/1000</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.938em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mord mtight\">/</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3488em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1512em;\"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.348em;\"><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>ì¦‰ positional encodingì˜ ê° ì°¨ì›ì€ ì‚¬ì¸ ê³¡ì„ ì— ëŒ€ì‘í•œë‹¤. PEëŠ” <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mi>Ï€</mi></mrow><annotation encoding=\"application/x-tex\">2\\pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">Ï€</span></span></span></span></span>ì—ì„œ ë¶€í„° <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>10000</mn><mo>â‹…</mo><mn>2</mn><mi>Ï€</mi></mrow><annotation encoding=\"application/x-tex\">10000 \\cdot 2\\pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">10000</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">â‹…</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">Ï€</span></span></span></span></span>ê¹Œì§€ì˜ ê¸°í•˜í•™ì  í˜•íƒœë¥¼ ë‚˜íƒ€ë‚¸ë‹¤. ì´ë ‡ê²Œ í•¨ìœ¼ë¡œì„œ ìƒìˆ˜ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span>ì— ëŒ€í•´ ìƒëŒ€ì ì¸ ìœ„ì¹˜ì¸ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi><mi>E</mi><mo stretchy=\"false\">(</mo><mi>p</mi><mi>o</mi><mi>s</mi><mo>+</mo><mi>k</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">PE(pos+k)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">PE</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">os</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose\">)</span></span></span></span></span>ë¥¼ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi><mi>E</mi><mo stretchy=\"false\">(</mo><mi>p</mi><mi>o</mi><mi>s</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">PE(pos)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">PE</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">os</span><span class=\"mclose\">)</span></span></span></span></span>ì˜ ì„ í˜• í•¨ìˆ˜ë¡œ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆë‹¤. trax.layers.Attentionì—ì„œ ì •ì˜í•˜ê³  ìˆëŠ” <code>PositionalEncoding</code> ë„ ê°™ì€ ë°©ë²•ì„ ì ìš©í–ˆë‹¤.</p>\n<br>\n<p>ğŸ“‚ ë‹¤ìŒ ì½”ë“œëŠ” Trax ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ <code>PositionalEncoding</code> ë ˆì´ì–´ë‹¤.</p>\n<pre class=\"grvsc-container abyss\" data-language=\"python\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15 mtki\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">PositionalEncoding</span><span class=\"mtk1\">(</span><span class=\"mtk6 mtki mtku\">base</span><span class=\"mtk1\">.</span><span class=\"mtk6 mtki mtku\">Layer</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">forward</span><span class=\"mtk1\">(</span><span class=\"mtk19 mtki\">self</span><span class=\"mtk1\">, </span><span class=\"mtk19 mtki\">inputs</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">&quot;&quot;&quot;Returns the input activations, with added positional information.&quot;&quot;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    weights </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> self.weights</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    emb </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> fastmath.dynamic_slice_in_dim(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        weights, self.state, inputs.shape[</span><span class=\"mtk4\">1</span><span class=\"mtk1\">], </span><span class=\"mtk19 mtki\">axis</span><span class=\"mtk7\">=</span><span class=\"mtk4\">1</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    self.state </span><span class=\"mtk7\">+=</span><span class=\"mtk1\"> inputs.shape[</span><span class=\"mtk4\">1</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> inputs </span><span class=\"mtk7\">+</span><span class=\"mtk1\"> emb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">init_weights_and_state</span><span class=\"mtk1\">(</span><span class=\"mtk19 mtki\">self</span><span class=\"mtk1\">, </span><span class=\"mtk19 mtki\">input_signature</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">&quot;&quot;&quot;Randomly initializes the positional encoding vectors.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">    &quot;&quot;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    d_feature </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> input_signature.shape[</span><span class=\"mtk7\">-</span><span class=\"mtk4\">1</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> self._d_feature </span><span class=\"mtk7\">is</span><span class=\"mtk1\"> </span><span class=\"mtk7\">not</span><span class=\"mtk1\"> </span><span class=\"mtk4\">None</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      d_feature </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> self._d_feature</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    pe </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> np.zeros((self._max_len, d_feature), </span><span class=\"mtk19 mtki\">dtype</span><span class=\"mtk7\">=</span><span class=\"mtk1\">np.float32)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    position </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> np.arange(</span><span class=\"mtk4\">0</span><span class=\"mtk1\">, self._max_len)[:, np.newaxis]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    div_term </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> np.exp(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        np.arange(</span><span class=\"mtk4\">0</span><span class=\"mtk1\">, d_feature, </span><span class=\"mtk4\">2</span><span class=\"mtk1\">) </span><span class=\"mtk7\">*</span><span class=\"mtk1\"> </span><span class=\"mtk7\">-</span><span class=\"mtk1\">(np.log(</span><span class=\"mtk4\">10000.0</span><span class=\"mtk1\">) </span><span class=\"mtk7\">/</span><span class=\"mtk1\"> d_feature))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    pe[:, </span><span class=\"mtk4\">0</span><span class=\"mtk1\">::</span><span class=\"mtk4\">2</span><span class=\"mtk1\">] </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> np.sin(position </span><span class=\"mtk7\">*</span><span class=\"mtk1\"> div_term)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    pe[:, </span><span class=\"mtk4\">1</span><span class=\"mtk1\">::</span><span class=\"mtk4\">2</span><span class=\"mtk1\">] </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> np.cos(position </span><span class=\"mtk7\">*</span><span class=\"mtk1\"> div_term)  </span><span class=\"mtk3\"># [self._max_len, d_feature]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> self._use_bfloat16:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      pe </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> pe.astype(jnp.bfloat16)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    w </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> jnp.array(pe)  </span><span class=\"mtk3\"># Trainable parameters, initialized above.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># ...</span></span></span></code></pre>\n<p><code>init_weights_and_state</code> í•¨ìˆ˜ëŠ” <code>ShapeDtype</code> ê°ì²´ë¥¼ ì…ë ¥ë°›ì•„ì„œ ì„ë² ë”© í¬ê¸° <code>(max_len, d_feature)</code> í¬ê¸°ì˜ ë²¡í„° <code>pe</code>ë¥¼ ì´ˆê¸°í™” í•œë‹¤. <code>pe</code> ë²¡í„°ì˜ ì§ìˆ˜ í–‰ì—ëŠ” <code>positon * div_term</code>ì˜ sine ê°’ì„ í• ë‹¹í•˜ê³  í™€ìˆ˜ í–‰ì—ëŠ” cosine ê°’ì„ í• ë‹¹í•œë‹¤. ì´ ê°’ì„ <code>weights</code>ë¡œ ì „ë‹¬í•´ í•¨ìˆ˜<code>forward</code>ì—ì„œ <code>emb</code> ê°’ìœ¼ë¡œ ì…ë ¥ê°’ì— ë”í•´ ì „ë‹¬í•˜ê³  ìˆë‹¤. ì¦‰ ì‚¬ì¸ê³¼ ì½”ì‚¬ì¸ ê°’ìœ¼ë¡œ ìœ„ì¹˜ì •ë³´ë¥¼ ì¸ì½”ë”©í•´ ì…ë ¥ê°’ì— ë”í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ positional encodingì„ ìˆ˜í–‰í•œë‹¤.</p>\n<br>\n<h3>ğŸ“£ Encoder Self-Attention</h3>\n<p>ì¸ì½”ë”ëŠ” ì…€í”„-ì–´í…ì…˜ ë ˆì´ì–´ë¥¼ í™œìš©í•œë‹¤. ì…€í”„-ì–´í…ì…˜ì€ ì£¼ì–´ì§„ ë°ì´í„°ì˜ ë¶€ë¶„ê°’ê³¼ ë‹¤ë¥¸ ë¶€ë¶„ë“¤ì˜ ê´€ê³„ë¥¼ íŒŒì•…í•˜ëŠ” ë°©ë²•ì´ë‹¤. ì¦‰ ë¬¸ì¥ ë°ì´í„°ì—ì„œ ì…€í”„-ì–´í…ì…˜ì€ ë¬¸ì¥ ë‚´ì˜ ë‹¨ì–´ ë¬¸ë§¥ì„ íŒŒì•…í•œë‹¤. ì•ì„œ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span>ì˜ ê°’ì€ ì–´í…ì…˜ì— ë”°ë¼ ë‹¤ë¥´ë‹¤ê³  í–ˆëŠ”ë°, ì…€í”„-ì–´í…ì…˜ ë ˆì´ì–´ì—ì„œëŠ” ëª¨ë“  <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span>ê°€ ê°™ì€ ì‹œí€€ìŠ¤, ì¦‰ ì¸ì½”ë”ì˜ ì´ì „ ë ˆì´ì–´ì˜ ê²°ê³¼ê°’ì—ì„œ ì˜¨ë‹¤. ì£¼ì–´ì§„ ë¬¸ì¥ì´ ìˆì„ ë•Œ, ì„ì˜ì˜ ë‹¨ì–´ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>w</mi></mrow><annotation encoding=\"application/x-tex\">w</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span></span></span></span></span>ì— ëŒ€ì‘í•˜ëŠ” ì„ë² ë”©ì— ëŒ€í•œ ê°€ì¤‘ì¹˜ë¥¼ í•™ìŠµí•  ìˆ˜ ìˆë‹¤. ì„ë² ë”©ì— ê°€ì¤‘ì¹˜ë¥¼ ê³±í•´ ì–»ì€ ì¿¼ë¦¬ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span></span></span></span></span>ì— ëŒ€í•´ ëª¨ë“  <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi><mo>âˆˆ</mo><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">k \\in K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7335em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">âˆˆ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span></span>ì™€ dot productë¡œ ë¹„êµí•´ì„œ ìœ ì‚¬ë„ ì ìˆ˜ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤. ê·¸ ë‹¤ìŒ softmax í•¨ìˆ˜ë¥¼ í†µí•´ ëª¨ë“  ê°€ì¤‘ì¹˜ë¥¼ ë”í•´ì„œ 1ì´ ë˜ëŠ” ì–‘ìˆ˜ê°’ìœ¼ë¡œ ë³€í™˜í•œë‹¤. ê·¸ í›„ ë‘ë²ˆì§¸ dot productë¡œ ë‹¨ì–´ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>w</mi></mrow><annotation encoding=\"application/x-tex\">w</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span></span></span></span></span>ì— ëŒ€ì‘í•˜ëŠ” ë‹¤ë¥¸ ë‹¨ì–´ë“¤ì˜ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span>ê°’ë“¤ì„ êµ¬í•´ ë‹¤ì‹œ í•™ìŠµí•œ ê°€ì¤‘ì¹˜ í–‰ë ¬ì„ ê³±í•¨ìœ¼ë¡œì„œ ëª¨ë“  ê°€ì¤‘ì¹˜ í•©ì„ êµ¬í•œë‹¤. ì´ê²ƒì´ ë‹¨ì–´ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>w</mi></mrow><annotation encoding=\"application/x-tex\">w</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span></span></span></span></span>ì— ëŒ€í•œ ì–´í…ì…˜ì´ë‹¤.</p>\n<!--<figure>-->\n<!--    <a href=\"/imgs/post-imgs/transformer-attention2.png\"><img src=\"/imgs/post-imgs/transformer-attention2.png\"></a>-->\n<!--    <figcaption>Self-attention, Vaswani et al., 2017.</figcaption>-->\n<!--</figure>-->\n<p>ìœ„ ê·¸ë¦¼ì€ <em>\"making\"</em> ë‹¨ì–´ì— ëŒ€í•œ ì–´í…ì…˜ì„ í‘œí˜„í•˜ê³  ìˆë‹¤. ìœ„ ì–´í…ì…˜ì˜ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span>ëŠ” ëª¨ë‘ í•œ ë¬¸ì¥ _\"It is in this spirit that a majority of American governments have passed new laws since 2009 making the registration or voting process more difficult. <EOS> <pad> ...\"_ì—ì„œ ì–»ì–´ì§„ë‹¤. ë‹¤ë¥¸ ìƒ‰ê¹”ì€ ë‹¤ë¥¸ headë¥¼ ë‚˜íƒ€ë‚´ë©° ìƒ‰ì´ ì„ ëª…í• ìˆ˜ë¡ ê´€ê³„ë„ê°€ ë†’ë‹¤. _\"making\"_ê³¼ ì—°ê´€ëœ headëŠ” <em>\"making ... more difficult\"</em> êµ¬ë¬¸ì„ ì™„ì„±í•œë‹¤.</p>\n<p>ë¬¼ë¡  íš¨ìœ¨ì„ ìœ„í•´ ìš°ë¦¬ëŠ” í–‰ë ¬ ë‹¨ìœ„ë¡œ ì–´í…ì…˜ì„ ì—°ì‚°í•œë‹¤. ì£¼ì–´ì§„ ë¬¸ì¥ì˜ ë‹¨ì–´ ì„ë² ë”©ì´ ì„ë² ë”© ì°¨ì› embì— ëŒ€í•´ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msub><mi>n</mi><mrow><mi>s</mi><mi>e</mi><mi>q</mi></mrow></msub><mo separator=\"true\">,</mo><mi>e</mi><mi>m</mi><mi>b</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(n_{seq}, emb)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">se</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">q</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">mb</span><span class=\"mclose\">)</span></span></span></span></span> ì°¨ì›ì´ë¼ê³  í•˜ì. ìš°ë¦¬ëŠ” <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>e</mi><mi>m</mi><mi>b</mi><mo separator=\"true\">,</mo><msub><mi>d</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(emb, d_{model})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">mb</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span>ì°¨ì›ì˜ ê°€ì¤‘ì¹˜ í–‰ë ¬ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>W</mi><mi>Q</mi></msup></mrow><annotation encoding=\"application/x-tex\">W^Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8413em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">Q</span></span></span></span></span></span></span></span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>W</mi><mi>K</mi></msup></mrow><annotation encoding=\"application/x-tex\">W^K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8413em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">K</span></span></span></span></span></span></span></span></span></span></span></span>, ê·¸ë¦¬ê³  <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>W</mi><mi>V</mi></msup></mrow><annotation encoding=\"application/x-tex\">W^V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8413em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span></span></span></span></span></span></span></span>ì„ í•™ìŠµí•œë‹¤. ë‹¨ì–´ì— ëŒ€í•´ í–ˆë˜ ê²ƒê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ì„ë² ë”© í–‰ë ¬ì— ê°€ì¤‘ì¹˜ í–‰ë ¬ì„ ê³±í•´ì„œ ê°ê° <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msub><mi>n</mi><mrow><mi>s</mi><mi>e</mi><mi>q</mi></mrow></msub><mo separator=\"true\">,</mo><msub><mi>d</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(n_{seq}, d_{model})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">se</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">q</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span> ì°¨ì›ì˜ í–‰ë ¬ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span></span>, ê·¸ë¦¬ê³  <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span>ë¥¼ ë„ì¶œí•  ìˆ˜ ìˆë‹¤. ì´í›„ì˜ ì–´í…ì…˜ ì—°ì‚°ì€ scaled-dot product ì–´í…ì…˜ì—ì„œ ì‚´í´ë³¸ ê²ƒê³¼ ê°™ë‹¤. Multi-head ì…€í”„-ì–´í…ì…˜ì„ ì‹¤í–‰í•œë‹¤ë©´, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mo>âˆˆ</mo><msub><mi>n</mi><mrow><mi>h</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">i \\in n_{heads}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6986em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">âˆˆ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">h</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\">s</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span>ì— ëŒ€í•´ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mi>W</mi><mi>i</mi><mi>Q</mi></msubsup></mrow><annotation encoding=\"application/x-tex\">W^Q_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2361em;vertical-align:-0.2769em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9592em;\"><span style=\"top:-2.4231em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span><span style=\"top:-3.1809em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">Q</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2769em;\"><span></span></span></span></span></span></span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mi>W</mi><mi>i</mi><mi>K</mi></msubsup></mrow><annotation encoding=\"application/x-tex\">W^K_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1em;vertical-align:-0.2587em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-2.4413em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">K</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2587em;\"><span></span></span></span></span></span></span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mi>W</mi><mi>i</mi><mi>V</mi></msubsup></mrow><annotation encoding=\"application/x-tex\">W^V_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1em;vertical-align:-0.2587em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-2.4413em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.22222em;\">V</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2587em;\"><span></span></span></span></span></span></span></span></span></span></span>ë¥¼ í›ˆë ¨í•˜ê³  <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>Q</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">Q_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">Q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>K</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">K_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>V</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">V_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span>ë¡œ ì–´í…ì…˜ì„ ì—°ì‚°í•œ í›„, ì–´í…ì…˜ ê²°ê³¼ê°’ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>Z</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">Z_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">Z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span>ë¥¼ ê²°í•©í•œ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Z</mi></mrow><annotation encoding=\"application/x-tex\">Z</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">Z</span></span></span></span></span>ì— í•™ìŠµí•œ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msub><mi>n</mi><mrow><mi>s</mi><mi>e</mi><mi>q</mi></mrow></msub><mo separator=\"true\">,</mo><msub><mi>d</mi><mi>v</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(n_{seq}, d_v)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">se</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">q</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span> ì°¨ì›ì˜ ê°€ì¤‘ì¹˜ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>W</mi><mi>O</mi></msup></mrow><annotation encoding=\"application/x-tex\">W^O</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8413em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">O</span></span></span></span></span></span></span></span></span></span></span></span> í–‰ë ¬ì„ ê³±í•´ ìµœì¢…ì ìœ¼ë¡œ multi-head ì–´í…ì…˜ì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤.</p>\n<br>\n<p>ğŸ“‚ ë‹¤ìŒ ì½”ë“œëŠ” Trax ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ <code>Attention</code> ëª¨ë¸ë¡œ, Multi-Head ì…€í”„-ì–´í…ì…˜ì„ ìˆ˜í–‰í•œë‹¤.</p>\n<pre class=\"grvsc-container abyss\" data-language=\"python\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">Attention</span><span class=\"mtk1\">(</span><span class=\"mtk19 mtki\">d_feature</span><span class=\"mtk1\">, </span><span class=\"mtk19 mtki\">n_heads</span><span class=\"mtk7\">=</span><span class=\"mtk4\">1</span><span class=\"mtk1\">, </span><span class=\"mtk19 mtki\">dropout</span><span class=\"mtk7\">=</span><span class=\"mtk4\">0.0</span><span class=\"mtk1\">, </span><span class=\"mtk19 mtki\">mode</span><span class=\"mtk7\">=</span><span class=\"mtk11\">&#39;train&#39;</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk11\">&quot;&quot;&quot;Returns a layer that maps `(vectors, mask)` to `(new_vectors, mask)`.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  This layer type represents one pass of multi-head self-attention, from vector</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  set to vector set, using masks to represent out-of-bound (e.g., padding)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  positions. ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  &quot;&quot;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> cb.Serial(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      cb.Select([</span><span class=\"mtk4\">0</span><span class=\"mtk1\">, </span><span class=\"mtk4\">0</span><span class=\"mtk1\">, </span><span class=\"mtk4\">0</span><span class=\"mtk1\">]),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      AttentionQKV(d_feature, </span><span class=\"mtk19 mtki\">n_heads</span><span class=\"mtk7\">=</span><span class=\"mtk1\">n_heads, </span><span class=\"mtk19 mtki\">dropout</span><span class=\"mtk7\">=</span><span class=\"mtk1\">dropout, </span><span class=\"mtk19 mtki\">mode</span><span class=\"mtk7\">=</span><span class=\"mtk1\">mode),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  )</span></span></span></code></pre>\n<p>ë””ì½”ë”ì—ì„œ ì‚´í´ë³´ê² ì§€ë§Œ, <code>AttentionQKV</code>ëŠ” <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span>ë¥¼ ë‹¤ë¥¸ ì…ë ¥ì—ì„œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ ì…€í”„-ì–´í…ì…˜ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ <code>Attention</code>ì€ <code>Select</code>ë¡œ ì²«ë²ˆì§¸ ì…ë ¥ê°’ì„ 3ê°œë¡œ ë³µì œí•œ ê°’ì„ <code>AttentionQKV</code>ì— ì „ë‹¬í•œë‹¤.</p>\n<p>ë˜ ì¸ì½”ë”ì˜ ì…€í”„-ì–´í…ì…˜ì€ <strong>Padding Mask</strong>ë¥¼ í™œìš©í•œë‹¤.</p>\n<pre class=\"grvsc-container abyss\" data-language=\"python\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">PaddingMask</span><span class=\"mtk1\">(</span><span class=\"mtk19 mtki\">pad</span><span class=\"mtk7\">=</span><span class=\"mtk4\">0</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk11\">&quot;&quot;&quot;Returns a layer that maps integer sequences to padding masks.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  The layer expects as input a batch of integer sequences. The layer output is</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  an N-D array that marks for each sequence position whether the integer (e.g.,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  a token ID) in that position represents padding -- value ``pad`` -- versus</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  text/content -- all other values. The padding mask shape is</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  (batch_size, 1, 1, encoder_sequence_length), such that axis 1 will broadcast</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  to cover any number of attention heads and axis 2 will broadcast to cover</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  decoder sequence positions. ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  &quot;&quot;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">f</span><span class=\"mtk1\">(</span><span class=\"mtk19 mtki\">x</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> </span><span class=\"mtk15\">len</span><span class=\"mtk1\">(x.shape) </span><span class=\"mtk7\">!=</span><span class=\"mtk1\"> </span><span class=\"mtk4\">2</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">raise</span><span class=\"mtk1\"> </span><span class=\"mtk15 mtki\">ValueError</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk15 mtki\">f</span><span class=\"mtk11\">&#39;Input to PaddingMask must be a 2-D array with shape &#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk15 mtki\">f</span><span class=\"mtk11\">&#39;(batch_size, sequence_length); instead got shape </span><span class=\"mtk4\">{</span><span class=\"mtk1\">x.shape</span><span class=\"mtk4\">}</span><span class=\"mtk11\">.&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    batch_size </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> x.shape[</span><span class=\"mtk4\">0</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    sequence_length </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> x.shape[</span><span class=\"mtk4\">1</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    content_positions </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> (x </span><span class=\"mtk7\">!=</span><span class=\"mtk1\"> pad)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> content_positions.reshape((batch_size, </span><span class=\"mtk4\">1</span><span class=\"mtk1\">, </span><span class=\"mtk4\">1</span><span class=\"mtk1\">, sequence_length))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> Fn(</span><span class=\"mtk15 mtki\">f</span><span class=\"mtk11\">&#39;PaddingMask(</span><span class=\"mtk4\">{</span><span class=\"mtk1\">pad</span><span class=\"mtk4\">}</span><span class=\"mtk11\">)&#39;</span><span class=\"mtk1\">, f)</span></span></span></code></pre>\n<p>ì¦‰ íŒ¨ë”© í† í° <code>pad</code>ë¡œ ì„¤ì •ëœ ê°’ê³¼ ê°™ì€ ë¶€ë¶„ì„ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span></span>ìœ¼ë¡œ ë°”ê¾¼ë‹¤. ì¶œë ¥ ì°¨ì›ì€ <code>(batch_size, 1, 1, sequence_length)</code>ìœ¼ë¡œ, ì–´í…ì…˜ê³¼ ì°¨ì›ì„ ë§ì¶”ê¸° ìœ„í•´ 1ë²ˆê³¼ 2ë²ˆ ì¶•ì„ ì¶”ê°€í•œë‹¤.</p>\n<br>\n<br>\n<h2>2. Decoder</h2>\n<p>íŠ¸ëœìŠ¤í¬ë¨¸ì˜ ë””ì½”ë”ëŠ” ë‘ ê°€ì§€ ì–´í…ì…˜ì„ ê±°ì¹œë‹¤. ì²« ë²ˆì§¸ ì–´í…ì…˜ì€ ì¸ì½”ë”ì—ì„œì™€ ê°™ì€ ì…€í”„-ì–´í…ì…˜ì´ê³ , ë‘ë²ˆì§¸ëŠ” ì¸ì½”ë”-ë””ì½”ë” ì–´í…ì…˜ì´ë‹¤. ì¸ì½”ë”ë§Œ ì‚¬ìš©í•´ ëª¨ë¸ì„ ë§Œë“¤ ìˆ˜ ìˆì—ˆë˜ ê²ƒì²˜ëŸ¼, ë””ì½”ë”ë§Œ ì‚¬ìš©í•´ì„œ ëª¨ë¸ì„ í˜•ì„±í•  ìˆ˜ë„ ìˆë‹¤. ë””ì½”ë”ë§Œ ì‚¬ìš©í•  ë•Œì—ëŠ” Multi-Head ì…€í”„-ì–´í…ì…˜ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.</p>\n<!--<figure>-->\n<!--    <a href=\"/imgs/post-imgs/transformer-decoder.png\"><img src=\"/imgs/post-imgs/transformer-decoder.png\"></a>-->\n<!--    <figcaption>Decoder structure, from deeplearning.ai.</figcaption>-->\n<!--</figure>-->\n<p>ì¸ì½”ë”ì—ì„œì™€ ë§ˆì°¬ê°€ì§€ë¡œ ë””ì½”ë”ì—ì„œë„ ì…ë ¥ê°’ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span></span>, <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span>ë¥¼ ì„ë² ë“œí•˜ê³  Positional Encoding ì²˜ë¦¬ë¥¼ í•œ í›„ì— Residualì„ í¬í•¨í•œ 1ï¸âƒ£ Multi-Head Attentionê³¼ 2ï¸âƒ£ FeedForward ë ˆì´ì–´ë¥¼ ê±°ì¹œë‹¤. ë””ì½”ë” ë¸”ëŸ­ì„ ì—¬ëŸ¬ë²ˆ ê±°ì¹œ í›„ì— í›ˆë ¨ ê°€ëŠ¥í•œ Linear ë ˆì´ì–´ì™€ Softmax í•¨ìˆ˜ë¥¼ ê±°ì¹˜ëŠ”ë°, ì´ ë¶€ë¶„ì€ ìˆ˜í–‰í•˜ê³ ì í•˜ëŠ” ê³¼ì œì— ë”°ë¼ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.</p>\n<br>\n<p>ğŸ“‚ ë‹¤ìŒ ì½”ë“œëŠ” Trax ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ <code>TransformerLM</code>ë¡œ, ë””ì½”ë”ë§Œ êµ¬í˜„ëœ í•¨ìˆ˜ì´ë‹¤.</p>\n<pre class=\"grvsc-container abyss\" data-language=\"python\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">TransformerLM</span><span class=\"mtk1\">(</span><span class=\"mtk19 mtki\">vocab_size</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                  </span><span class=\"mtk19 mtki\">d_model</span><span class=\"mtk7\">=</span><span class=\"mtk4\">D_MODEL</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                  </span><span class=\"mtk19 mtki\">d_ff</span><span class=\"mtk7\">=</span><span class=\"mtk4\">D_FF</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                  </span><span class=\"mtk19 mtki\">n_layers</span><span class=\"mtk7\">=</span><span class=\"mtk4\">N_LAYERS</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                  </span><span class=\"mtk19 mtki\">n_heads</span><span class=\"mtk7\">=</span><span class=\"mtk4\">N_HEADS</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                  </span><span class=\"mtk19 mtki\">max_len</span><span class=\"mtk7\">=</span><span class=\"mtk4\">MAX_SEQUENCE_LENGTH</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                  </span><span class=\"mtk19 mtki\">dropout</span><span class=\"mtk7\">=</span><span class=\"mtk4\">DROPOUT_RATE</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                  </span><span class=\"mtk19 mtki\">dropout_shared_axes</span><span class=\"mtk7\">=</span><span class=\"mtk4\">DROPOUT_SHARED_AXES</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                  </span><span class=\"mtk19 mtki\">mode</span><span class=\"mtk7\">=</span><span class=\"mtk4\">MODE</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                  </span><span class=\"mtk19 mtki\">ff_activation</span><span class=\"mtk7\">=</span><span class=\"mtk4\">FF_ACTIVATION_TYPE</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">_DecBlock</span><span class=\"mtk1\">():</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> _DecoderBlock(d_model, d_ff, n_heads, dropout, dropout_shared_axes,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                         mode, ff_activation)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> tl.Serial(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.ShiftRight(</span><span class=\"mtk19 mtki\">mode</span><span class=\"mtk7\">=</span><span class=\"mtk1\">mode),  </span><span class=\"mtk3\"># Teacher Forcing</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.Embedding(vocab_size, d_model),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      _Dropout(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.PositionalEncoding(</span><span class=\"mtk19 mtki\">max_len</span><span class=\"mtk7\">=</span><span class=\"mtk1\">max_len, </span><span class=\"mtk19 mtki\">mode</span><span class=\"mtk7\">=</span><span class=\"mtk1\">mode),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      [_DecBlock() </span><span class=\"mtk7\">for</span><span class=\"mtk1\"> _ </span><span class=\"mtk7\">in</span><span class=\"mtk1\"> </span><span class=\"mtk15\">range</span><span class=\"mtk1\">(n_layers)],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.LayerNorm(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.Dense(vocab_size),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  )</span></span></span></code></pre>\n<p><code>_DecoderBlock</code>ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>\n<pre class=\"grvsc-container abyss\" data-language=\"python\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">_DecoderBlock</span><span class=\"mtk1\">(</span><span class=\"mtk19 mtki\">d_model</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                  </span><span class=\"mtk19 mtki\">d_ff</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                  </span><span class=\"mtk19 mtki\">n_heads</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                  </span><span class=\"mtk19 mtki\">dropout</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                  </span><span class=\"mtk19 mtki\">dropout_shared_axes</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                  </span><span class=\"mtk19 mtki\">mode</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                  </span><span class=\"mtk19 mtki\">ff_activation</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.Residual(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          tl.LayerNorm(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          _CausalAttention(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          _Dropout(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      ),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.Residual(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          tl.LayerNorm(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          _FFBlock(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          _Dropout(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      ),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  ]</span></span></span></code></pre>\n<p><code>TransformerLM</code> í•¨ìˆ˜ëŠ” Teacher Forcingì„ ê±°ì³ ì„ë² ë”©, positional encoding ì²˜ë¦¬ í›„ <code>n_layers</code>ë§Œí¼ì˜ ë””ì½”ë” ë¸”ëŸ­ì„ ê±°ì³ <code>tl.LayerNorm()</code>ê³¼ <code>vocab_size</code>ë§Œí¼ì˜ <code>tl.Dense()</code> ë ˆì´ì–´ì„ í†µê³¼í•˜ëŠ” êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ìˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ ì‚¬ì „ì— ì£¼ì–´ì§„ ë‹¨ì–´ë“¤ì„ í†µí•´ ë‹¤ìŒì— ì˜¬ ë‹¨ì–´ë¥¼ vocabulary ë‚´ì˜ í† í°ìœ¼ë¡œ ì˜ˆì¸¡í•˜ëŠ” ì–¸ì–´ ëª¨ë¸(language model)ì„ ìˆ˜í–‰í•œë‹¤.</p>\n<br>\n<h3>ğŸ”† Teacher Forcing</h3>\n<p>ë””ì½”ë” ë¸”ëŸ­ì— ë“¤ì–´ê°€ê¸°ì— ì•ì„œ, Teacher Forcing ê¸°ë²•ì„ í™œìš©í•´ ëª¨ë¸ì˜ í›ˆë ¨ ì†ë„ë¥¼ ë†’ì¼ ìˆ˜ ìˆë‹¤. RNN ëª¨ë¸ì¸ Seq2Seq ëª¨ë¸ì€ ë°”ë¡œ ì „ ë ˆì´ì–´ì˜ ì˜ˆì¸¡ ê°’ì„ ë‹¤ìŒ ë ˆì´ì–´ì˜ ì…ë ¥ê°’ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤. ë•Œë¬¸ì— ëª¨ë¸ í›ˆë ¨ ì´ˆê¸°ì˜ (ëœ í›ˆë ¨ëœ) ë‚˜ìœ ì˜ˆì¸¡ ê°’ì´ ê³„ì†í•´ì„œ ëª¨ë¸ í›ˆë ¨ì— ì˜í–¥ì„ ì¤„ ê°€ëŠ¥ì„±ì´ í¬ë‹¤. ì´ëŸ° ë¬¸ì œë¥¼ ì™„í™”í•˜ê¸° ìœ„í•´ ì´ì „ ë ˆì´ì–´ì˜ ì˜ˆì¸¡ê°’ì´ ì•„ë‹Œ ì‹¤ì œ íƒ€ì¼“ ê°’ì„ ë‹¤ìŒ ë ˆì´ì–´ì˜ ì…ë ¥ê°’ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ Teacher Forcingì´ë¼ê³  í•œë‹¤. ë§ˆì¹˜ ì„ ìƒë‹˜ì´ ì§ì ‘ ì´ë ‡ê²Œ í•˜ë¼ê³  ì§€ë„í•´ì£¼ëŠ” ê²ƒê³¼ ê°™ë‹¤. í›ˆë ¨ ì´ˆê¸°ì— íƒ€ê²Ÿ ê°’ì— ìˆ˜ë ´í•˜ëŠ” ê²ƒì„ ë•ê¸° ë•Œë¬¸ì—, ì´ ë°©ë²•ìœ¼ë¡œ ëª¨ë¸ í›ˆë ¨ ì†ë„ë¥¼ íšê¸°ì ìœ¼ë¡œ ë†’ì¼ ìˆ˜ ìˆë‹¤.</p>\n<p>ìœ„ì˜ ì½”ë“œì—ì„œ ë‚˜íƒ€ë‚œ <code>ShiftRight</code> ë ˆì´ì–´ê°€ teacher forcing ì—­í• ì„ í•œë‹¤. ì¦‰ (í•œ ì‹œì  ë¯¸ë˜ ê°’ì¸) ë°”ë¡œ ì˜¤ë¥¸ ìª½ ê°’ì„ ê°€ì ¸ì˜¤ëŠ” ê²ƒìœ¼ë¡œ í•™ìŠµí•˜ëŠ” ëª¨ë¸ì„ êµì •í•  ìˆ˜ ìˆë‹¤. ìœ„ì˜ ì½”ë“œì—ì„œ <code>mode</code>ê°€ ì¸ìë¡œ ë“¤ì–´ê°„ ì´ìœ ë„, í•™ìŠµ ì™¸ì— ì˜ˆì¸¡ì„ ìˆ˜í–‰í•  ë•ŒëŠ” teacher forcingì„ ì ìš©í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì´ë‹¤.</p>\n<p>ê·¸ë ‡ì§€ë§Œ Teacher Forcingì€ ëª¨ë¸ì„ í›ˆë ¨í•˜ëŠ” ê³¼ì •ì—ì„œ ì‹¤ì œ íƒ€ê²Ÿê°’ì„ ë…¸ì¶œí•˜ê¸° ë•Œë¬¸ì— ëª¨ë¸ì˜ ì•ˆì •ì„±, ì¦‰ ë³´ë‹¤ ì¼ë°˜ì ì¸ ì˜ˆì— ëŒ€í•œ ì˜ˆì¸¡ ëŠ¥ë ¥ì´ ë–¨ì–´ì§ˆ ìˆ˜ ìˆë‹¤. ì´ë ‡ê²Œ í›ˆë ¨ ì¤‘ì— Labelì— ë…¸ì¶œë˜ëŠ” ê²½ìš°ë¥¼ <strong>Exposure Bias</strong>ê°€ ìˆë‹¤ê³  í•œë‹¤. ì´ ë•Œë¬¸ì— curriculum learning ë°©ë²•ì—ì„œëŠ” FeedForwardì˜ í•™ìŠµ ì´ˆê¸°ì—ë§Œ ì´ì „ ë ˆì´ì–´ì˜ ì˜ˆì¸¡ê°’ì„ íƒ€ê²Ÿ ê°’ìœ¼ë¡œ ëŒ€ì²´í•˜ê³  í•™ìŠµ í›„ê¸°ì—ëŠ” ëŒ€ì²´ í•˜ì§€ ì•ŠëŠ”ë‹¤.</p>\n<br>\n<h3>ğŸ“£ Causal Self-Attention</h3>\n<p>ë””ì½”ë”ì˜ ì…ë ¥ê°’ì— ëŒ€í•œ ì–´í…ì…˜ì„ ì‹¤í–‰í•  ë•Œë„ ì–´í…ì…˜ì—ì„œì™€ ë§ˆì°¬ê°€ì§€ë¡œ ë¬¸ë§¥ì„ ìœ„í•´ ì…€í”„-ì–´í…ì…˜ì„ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤. ë‹¨, ë””ì½”ë”ì˜ ì…€í”„-ì–´í…ì…˜ì€ <strong>Causal Mask</strong>ê°€ í•„ìš”í•˜ë‹¤. ì•ì—ì„œì™€ ê°™ì´ ê¸°ê³„ ë²ˆì—­ ê³¼ì œë¥¼ ê³ ë ¤í•´ë³´ì. RNNì€ ë””ì½”ë”ì˜ ì…ë ¥ê°’ì— ìˆœì°¨ì ìœ¼ë¡œ ì ‘ê·¼í•´ ë§¤ë²ˆ ì¸ì½”ë”ì˜ ê²°ê³¼ê°’ê³¼ í•´ë‹¹ ì‹œì ì˜ ë””ì½”ë” ì…ë ¥ê°’ì„ ë¹„êµí•  ê²ƒì´ë‹¤. ê·¸ë ‡ì§€ë§Œ ì–´í…ì…˜ì€ ëª¨ë“  ì‹œì ì˜ ë°ì´í„°ë¥¼ í•œë²ˆì— ë³¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ íŠ¹ì • ì‹œì ì—ì„œ ëª¨ë¸ì˜ íƒ€ê¹ƒì¸ ì˜¤ë¥¸ìª½ ê°’ì— ëŒ€í•œ ì ‘ê·¼(attend)ì„ ë°©ì§€í•´ì•¼ í•œë‹¤.</p>\n<p>ğŸ“‚ ë‹¤ìŒ ì½”ë“œëŠ” Traxì˜ <code>_causal_mask</code>ë¡œ, ì¸ìë¡œ ë°›ì€ <code>length</code> ê¸¸ì´ ì •ë°© í–‰ë ¬ì˜ lower triangular í–‰ë ¬ì„ ë°˜í™˜í•œë‹¤.</p>\n<pre class=\"grvsc-container abyss\" data-language=\"python\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">_causal_mask</span><span class=\"mtk1\">(</span><span class=\"mtk19 mtki\">length</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Not all backends define jnp.tril. However, using np.tril is inefficient</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># in that it creates a large global constant. </span><span class=\"mtk7\">TODO</span><span class=\"mtk3\">(kitaev): try to find an</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># alternative that works across all backends.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> fastmath.is_backend(fastmath.Backend.</span><span class=\"mtk4\">JAX</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> jnp.tril(jnp.ones((</span><span class=\"mtk4\">1</span><span class=\"mtk1\">, length, length), </span><span class=\"mtk19 mtki\">dtype</span><span class=\"mtk7\">=</span><span class=\"mtk1\">np.bool_), </span><span class=\"mtk19 mtki\">k</span><span class=\"mtk7\">=</span><span class=\"mtk4\">0</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">else</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> np.tril(np.ones((</span><span class=\"mtk4\">1</span><span class=\"mtk1\">, length, length), </span><span class=\"mtk19 mtki\">dtype</span><span class=\"mtk7\">=</span><span class=\"mtk1\">np.bool_), </span><span class=\"mtk19 mtki\">k</span><span class=\"mtk7\">=</span><span class=\"mtk4\">0</span><span class=\"mtk1\">)</span></span></span></code></pre>\n<p><code>DotProductCausalAttention</code> ì–´í…ì…˜ì€ 1ê°œ Head ì–´í…ì…˜ì„ êµ¬í˜„í•˜ëŠ” í•¨ìˆ˜ë¡œ <code>CausalAttention</code>ìœ¼ë¡œ êµ¬í˜„ë  ìˆ˜ ìˆë‹¤. ì£¼ëª©í•´ì„œ ë³¼ ì ì€ ëª¨ë¸ì´ ì˜ˆì¸¡ì„ ìˆ˜í–‰í•˜ì§€ ì•Šì„ ë•Œë§Œ Causal Maskë¥¼ í™œìš©í•˜ëŠ” ì ì´ë‹¤.</p>\n<pre class=\"grvsc-container abyss\" data-language=\"python\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15 mtki\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">DotProductCausalAttention</span><span class=\"mtk1\">(</span><span class=\"mtk6 mtki mtku\">base</span><span class=\"mtk1\">.</span><span class=\"mtk6 mtki mtku\">Layer</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk11\">&quot;&quot;&quot;Layer that computes attention strengths by masking out the &quot;future&quot;.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  Causal attention uses masking to prevent a given sequence position from</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  attending to positions greater than / following it. This is used, for</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  example, when training autoregressive sequence models, or when decoding a</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  sequence symbol by symbol.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  This layer performs the core per-head attention calculation. The layer</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  assumes that any splitting into attention heads precedes it, and that any</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  merging of attention heads will follow it.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  &quot;&quot;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">forward</span><span class=\"mtk1\">(</span><span class=\"mtk19 mtki\">self</span><span class=\"mtk1\">, </span><span class=\"mtk19 mtki\">inputs</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">&quot;&quot;&quot;Returns attention-computed activations.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">    Args:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">      inputs: A (queries, keys, values) tuple.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">    &quot;&quot;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    q, k, v </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> inputs</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> self._mode </span><span class=\"mtk7\">==</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&#39;predict&#39;</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      self.state, mask </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> _fast_inference_update_state(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          inputs, self.state,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk19 mtki\">mask_for_predict</span><span class=\"mtk7\">=</span><span class=\"mtk1\">mask_for_predict)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">else</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      sequence_length </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> q.shape[</span><span class=\"mtk7\">-</span><span class=\"mtk4\">2</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      mask </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> _causal_mask(sequence_length)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    activations, attn_strengths </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> _per_head_attention(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        q, k, v, mask, </span><span class=\"mtk19 mtki\">dropout</span><span class=\"mtk7\">=</span><span class=\"mtk1\">self._dropout, </span><span class=\"mtk19 mtki\">mode</span><span class=\"mtk7\">=</span><span class=\"mtk1\">self._mode, </span><span class=\"mtk19 mtki\">rng</span><span class=\"mtk7\">=</span><span class=\"mtk1\">self.rng)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">#...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> activations</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># ...</span></span></span></code></pre>\n<br>\n<h3>ğŸ“£ Encoder-Decoder Attention</h3>\n<p>ì´ì œ ë””ì½”ë”ì˜ ì…ë ¥ê°’ê³¼ ì¸ì½”ë”ì˜ ì…ë ¥ê°’ì„ ë¶„ì„í•˜ëŠ” ê³¼ì œê°€ ë‚¨ì•˜ë‹¤. ì¸ì½”ë”-ë””ì½”ë” ë¸”ëŸ­ì˜ ì…ë ¥ê°’ì€ <code>(vec_d, mask, vec_e)</code>ë¡œ íŒ¨ë”© ë§ˆìŠ¤í¬ <code>mask</code>ë¥¼ ì´ìš©í•´ íŒ¨ë”©ëœ ê°’ì— ëŒ€í•´ì„œëŠ” ì–´í…ì…˜ì„ ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤.</p>\n<br>\n<p>ğŸ“‚ ë‹¤ìŒ ì½”ë“œëŠ” Trax ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ <code>AttentionQKV</code> í•¨ìˆ˜ë¡œ, <code>Attention</code>ì´ ì…€í”„-ì–´í…ì…˜ë§Œ ìˆ˜í–‰í•˜ëŠ” ê²ƒê³¼ ë‹¬ë¦¬ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span></span>ì™€ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi><mo>âˆ’</mo><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">K-V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">âˆ’</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span>ë¥¼ ë‹¤ë¥¸ ë°ì´í„°ì—ì„œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ í—ˆìš©í•œë‹¤.</p>\n<pre class=\"grvsc-container abyss\" data-language=\"python\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">AttentionQKV</span><span class=\"mtk1\">(</span><span class=\"mtk19 mtki\">d_feature</span><span class=\"mtk1\">, </span><span class=\"mtk19 mtki\">n_heads</span><span class=\"mtk7\">=</span><span class=\"mtk4\">1</span><span class=\"mtk1\">, </span><span class=\"mtk19 mtki\">dropout</span><span class=\"mtk7\">=</span><span class=\"mtk4\">0.0</span><span class=\"mtk1\">, </span><span class=\"mtk19 mtki\">mode</span><span class=\"mtk7\">=</span><span class=\"mtk11\">&#39;train&#39;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                 </span><span class=\"mtk19 mtki\">cache_KV_in_predict</span><span class=\"mtk7\">=</span><span class=\"mtk4\">False</span><span class=\"mtk1\">, </span><span class=\"mtk19 mtki\">q_sparsity</span><span class=\"mtk7\">=</span><span class=\"mtk4\">None</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                 </span><span class=\"mtk19 mtki\">result_sparsity</span><span class=\"mtk7\">=</span><span class=\"mtk4\">None</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> cb.Serial(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      cb.Parallel(_SparsifiableDense(q_sparsity),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                  _CacheableDense(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                  _CacheableDense()),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      _PureAttention(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      _SparsifiableDense(result_sparsity),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  )</span></span></span></code></pre>\n<p><code>cb.Parallel</code>ì€ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span></span>ì— í•´ë‹¹í•˜ëŠ” ì…ë ¥ì„ ë°€ë„ <code>q_sparsity</code>ë¥¼ ê°€ì§€ëŠ” í–‰ë ¬ë¡œ, ê·¸ë¦¬ê³  <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span></span>ì™€ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span>ì— í•´ë‹¹í•˜ëŠ” ì…ë ¥ì„ <code>d_feature</code>ë§Œí¼ì˜ <code>Dense</code> ë ˆì´ì–´ë¡œ ë‘ê³ , <code>_PureAttention</code>ê³¼ ì¼ì¢…ì˜ í›ˆë ¨ê°€ëŠ¥í•œ <code>Dense</code> ë ˆì´ì–´ë¥¼ í†µê³¼í•œë‹¤.</p>\n<p>ìµœì¢…ì ìœ¼ë¡œ Trax ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ <code>_EncoderDecoderBlock</code> í•¨ìˆ˜ë¥¼ ë³´ì.</p>\n<pre class=\"grvsc-container abyss\" data-language=\"python\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">_EncoderDecoderBlock</span><span class=\"mtk1\">(</span><span class=\"mtk19 mtki\">d_model</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                         </span><span class=\"mtk19 mtki\">d_ff</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                         </span><span class=\"mtk19 mtki\">n_heads</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                         </span><span class=\"mtk19 mtki\">dropout</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                         </span><span class=\"mtk19 mtki\">dropout_shared_axes</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                         </span><span class=\"mtk19 mtki\">mode</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                         </span><span class=\"mtk19 mtki\">ff_activation</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">_Dropout</span><span class=\"mtk1\">():</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> tl.Dropout(</span><span class=\"mtk19 mtki\">rate</span><span class=\"mtk7\">=</span><span class=\"mtk1\">dropout, </span><span class=\"mtk19 mtki\">shared_axes</span><span class=\"mtk7\">=</span><span class=\"mtk1\">dropout_shared_axes, </span><span class=\"mtk19 mtki\">mode</span><span class=\"mtk7\">=</span><span class=\"mtk1\">mode)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">_AttentionQKV</span><span class=\"mtk1\">():</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> tl.AttentionQKV(d_model, </span><span class=\"mtk19 mtki\">n_heads</span><span class=\"mtk7\">=</span><span class=\"mtk1\">n_heads, </span><span class=\"mtk19 mtki\">dropout</span><span class=\"mtk7\">=</span><span class=\"mtk1\">dropout,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                           </span><span class=\"mtk19 mtki\">mode</span><span class=\"mtk7\">=</span><span class=\"mtk1\">mode, </span><span class=\"mtk19 mtki\">cache_KV_in_predict</span><span class=\"mtk7\">=</span><span class=\"mtk4\">True</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">_CausalAttention</span><span class=\"mtk1\">():</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> tl.CausalAttention(d_model, </span><span class=\"mtk19 mtki\">n_heads</span><span class=\"mtk7\">=</span><span class=\"mtk1\">n_heads, </span><span class=\"mtk19 mtki\">mode</span><span class=\"mtk7\">=</span><span class=\"mtk1\">mode)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">_FFBlock</span><span class=\"mtk1\">():</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> _FeedForwardBlock(d_model, d_ff, dropout, dropout_shared_axes, mode,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                             ff_activation)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> [                             </span><span class=\"mtk3\"># vec_d masks vec_e</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.Residual(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          tl.LayerNorm(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          _CausalAttention(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          _Dropout(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      ),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.Residual(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          tl.LayerNorm(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          tl.Select([</span><span class=\"mtk4\">0</span><span class=\"mtk1\">, </span><span class=\"mtk4\">2</span><span class=\"mtk1\">, </span><span class=\"mtk4\">2</span><span class=\"mtk1\">, </span><span class=\"mtk4\">1</span><span class=\"mtk1\">, </span><span class=\"mtk4\">2</span><span class=\"mtk1\">]),  </span><span class=\"mtk3\"># vec_d vec_e vec_e masks vec_e</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          _AttentionQKV(),             </span><span class=\"mtk3\"># vec_d masks vec_e</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          _Dropout(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      ),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.Residual(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          tl.LayerNorm(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          _FFBlock(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          _Dropout(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      ),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  ]</span></span></span></code></pre>\n<p><code>_EncoderDecoderBlock</code>ì€ ë””ì½”ë” ë²¡í„°, ë§ˆìŠ¤í¬, ì¸ì½”ë” ë²¡í„° ìŒì¸ <code>(vec_d, masks, vec_e)</code>ë¥¼ ì…ë ¥ë°›ëŠ”ë‹¤. ì—¬ê¸°ì„œ ë””ì½”ë”ì˜ ë‘ê°€ì§€ ì–´í…ì…˜ì„ ëª¨ë‘ ì‹¤í–‰í•˜ê³  ìˆìŒì— ìœ ì˜í•œë‹¤. ì²«ì§¸ë¡œ <code>_CausalAttention</code>ì„ ì ìš©í•œ í›„ <code>(vec_d, vec_e, vec_e, masks, vec_e)</code>ë¡œ ë°ì´í„°ë¥¼ ì •ë ¬í•œë‹¤. ì•ì—ì„œ ë¶€í„° ì„¸ ê°œ ì…ë ¥ì´ <code>_AttentionQKV()</code>ë ˆì´ì–´ë¥¼ ê±°ì³ì„œ ì…ë ¥ê°’ê³¼ ê°™ì€ ì°¨ì›ì¸ <code>(vec_d, masks, vec_e)</code>ë¥¼ ì–»ì–´ FeedForward ë¸”ëŸ­ì„ ê±°ì¹œë‹¤. ì¦‰ ì¸ì½”ë”-ë””ì½”ë” ì–´í…ì…˜ì—ì„œëŠ” ë””ì½”ë” ë²¡í„°ë¥¼ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span></span>ë¡œ, ì¸ì½”ë” ë²¡í„°ë¥¼ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span></span>ì™€ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></span>ë¡œ ì…ë ¥ë°›ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>\n<br>\n<br>\n<h2>4. Overall</h2>\n<p>ë‹¤ìŒì€ ì¸ì½”ë”©ê³¼ ë””ì½”ë”©ì„ ì§ê´€ì ìœ¼ë¡œ ë³´ì—¬ì£¼ëŠ”ê·¸ë¦¼ìœ¼ë¡œ, ì˜ì–´ ë¬¸ì¥ì„ í”„ë‘ìŠ¤ì–´ ë¬¸ì¥ìœ¼ë¡œ ë²ˆì—­í•˜ëŠ” ì˜ˆì‹œë¥¼ ë³´ì´ê³ ìˆë‹¤.</p>\n<!--![](\"https://3.bp.blogspot.com/-aZ3zvPiCoXM/WaiKQO7KRnI/AAAAAAAAB_8/7a1CYjp40nUg4lKpW7covGZJQAySxlg8QCLcBGAs/s1600/transform20fps.gif\"><img src=\"https://3.bp.blogspot.com/-aZ3zvPiCoXM/WaiKQO7KRnI/AAAAAAAAB_8/7a1CYjp40nUg4lKpW7covGZJQAySxlg8QCLcBGAs/s1600/transform20fps.gif\")-->\n<!--<figure>-->\n<!--    <a href=\"https://3.bp.blogspot.com/-aZ3zvPiCoXM/WaiKQO7KRnI/AAAAAAAAB_8/7a1CYjp40nUg4lKpW7covGZJQAySxlg8QCLcBGAs/s1600/transform20fps.gif\"><img src=\"https://3.bp.blogspot.com/-aZ3zvPiCoXM/WaiKQO7KRnI/AAAAAAAAB_8/7a1CYjp40nUg4lKpW7covGZJQAySxlg8QCLcBGAs/s1600/transform20fps.gif\"></a>-->\n<!--    <figcaption>Cool gif from Google AI blog</figcaption>-->\n<!--</figure>-->\n<p>Transformer ëª¨ë¸ì€ ì¸ì½”ë”ë‚˜ ë””ì½”ë”ë§Œìœ¼ë¡œë„ ì“°ì„ì´ ìˆì§€ë§Œ, ê¸°ê³„ ë²ˆì—­ê³¼ ê°™ì€ ì‹œí€€ìŠ¤-íˆ¬-ì‹œí€€ìŠ¤ ê³¼ì œì—ëŠ” ì¸ì½”ë”ì™€ ë””ì½”ë”ë¥¼ ëª¨ë‘ í™œìš©í•´ì•¼ í•œë‹¤. ì•„ë˜ì˜ <code>Transformer</code> ëª¨ë¸ì€ ì•ì„œ ì‚´í´ ë³¸ ì¸ì½”ë”ì™€ ë””ì½”ë” ë¸”ëŸ­ì„ í™œìš©í•´ ì „ì²´ íŠ¸ëœìŠ¤í¬ë¨¸ ëª¨ë¸ì„ ë°˜í™˜í•œë‹¤.</p>\n<br>\n<p>ğŸ“‚ ë‹¤ìŒ ì½”ë“œëŠ” Trax ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ <code>Transformer</code> ëª¨ë¸ì´ë‹¤.</p>\n<pre class=\"grvsc-container abyss\" data-language=\"python\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">Transformer</span><span class=\"mtk1\">(</span><span class=\"mtk19 mtki\">input_vocab_size</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk19 mtki\">output_vocab_size</span><span class=\"mtk7\">=</span><span class=\"mtk4\">None</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk19 mtki\">d_model</span><span class=\"mtk7\">=</span><span class=\"mtk4\">D_MODEL</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk19 mtki\">d_ff</span><span class=\"mtk7\">=</span><span class=\"mtk4\">D_FF</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk19 mtki\">n_encoder_layers</span><span class=\"mtk7\">=</span><span class=\"mtk4\">N_LAYERS</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk19 mtki\">n_decoder_layers</span><span class=\"mtk7\">=</span><span class=\"mtk4\">N_LAYERS</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk19 mtki\">n_heads</span><span class=\"mtk7\">=</span><span class=\"mtk4\">N_HEADS</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk19 mtki\">max_len</span><span class=\"mtk7\">=</span><span class=\"mtk4\">MAX_SEQUENCE_LENGTH</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk19 mtki\">dropout</span><span class=\"mtk7\">=</span><span class=\"mtk4\">DROPOUT_RATE</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk19 mtki\">dropout_shared_axes</span><span class=\"mtk7\">=</span><span class=\"mtk4\">DROPOUT_SHARED_AXES</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk19 mtki\">mode</span><span class=\"mtk7\">=</span><span class=\"mtk4\">MODE</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk19 mtki\">ff_activation</span><span class=\"mtk7\">=</span><span class=\"mtk4\">FF_ACTIVATION_TYPE</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk11\">&quot;&quot;&quot;Returns a full Transformer model.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  This model is an encoder-decoder that performs tokenized string-to-string</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  (&quot;source&quot;-to-&quot;target&quot;) transduction:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">  &quot;&quot;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">_Dropout</span><span class=\"mtk1\">():</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> tl.Dropout(</span><span class=\"mtk19 mtki\">rate</span><span class=\"mtk7\">=</span><span class=\"mtk1\">dropout, </span><span class=\"mtk19 mtki\">shared_axes</span><span class=\"mtk7\">=</span><span class=\"mtk1\">dropout_shared_axes, </span><span class=\"mtk19 mtki\">mode</span><span class=\"mtk7\">=</span><span class=\"mtk1\">mode)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">_EncBlock</span><span class=\"mtk1\">():</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> _EncoderBlock(d_model, d_ff, n_heads, dropout, dropout_shared_axes,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                         mode, ff_activation)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">_Encoder</span><span class=\"mtk1\">():</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    encoder </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> tl.Serial(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        in_embedder,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        _Dropout(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        tl.PositionalEncoding(</span><span class=\"mtk19 mtki\">max_len</span><span class=\"mtk7\">=</span><span class=\"mtk1\">max_len, </span><span class=\"mtk19 mtki\">mode</span><span class=\"mtk7\">=</span><span class=\"mtk1\">encoder_mode),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        [_EncBlock() </span><span class=\"mtk7\">for</span><span class=\"mtk1\"> _ </span><span class=\"mtk7\">in</span><span class=\"mtk1\"> </span><span class=\"mtk15\">range</span><span class=\"mtk1\">(n_encoder_layers)],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        tl.LayerNorm(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> tl.Cache(encoder) </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> mode </span><span class=\"mtk7\">==</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&#39;predict&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">else</span><span class=\"mtk1\"> encoder</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">_EncDecBlock</span><span class=\"mtk1\">():</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> _EncoderDecoderBlock(d_model, d_ff, n_heads, dropout,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                                dropout_shared_axes, mode, ff_activation)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Input to model is encoder-side tokens and decoder-side tokens: tok_d, tok_e</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Model output is decoder-side vectors and decoder-side tokens: vec_d  tok_d</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> tl.Serial(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.Select([</span><span class=\"mtk4\">0</span><span class=\"mtk1\">, </span><span class=\"mtk4\">1</span><span class=\"mtk1\">, </span><span class=\"mtk4\">1</span><span class=\"mtk1\">]),  </span><span class=\"mtk3\"># Copies decoder tokens for use in loss.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Encode.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.Branch([], tl.PaddingMask()),  </span><span class=\"mtk3\"># tok_e masks tok_d tok_d</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      _Encoder(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Decode.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.Select([</span><span class=\"mtk4\">2</span><span class=\"mtk1\">, </span><span class=\"mtk4\">1</span><span class=\"mtk1\">, </span><span class=\"mtk4\">0</span><span class=\"mtk1\">]),  </span><span class=\"mtk3\"># Re-orders inputs: tok_d masks vec_e .....</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.ShiftRight(</span><span class=\"mtk19 mtki\">mode</span><span class=\"mtk7\">=</span><span class=\"mtk1\">mode),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      out_embedder,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      _Dropout(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.PositionalEncoding(</span><span class=\"mtk19 mtki\">max_len</span><span class=\"mtk7\">=</span><span class=\"mtk1\">max_len, </span><span class=\"mtk19 mtki\">mode</span><span class=\"mtk7\">=</span><span class=\"mtk1\">mode),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.Branch([], tl.EncoderDecoderMask()),  </span><span class=\"mtk3\"># vec_d masks ..... .....</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      [_EncDecBlock() </span><span class=\"mtk7\">for</span><span class=\"mtk1\"> _ </span><span class=\"mtk7\">in</span><span class=\"mtk1\"> </span><span class=\"mtk15\">range</span><span class=\"mtk1\">(n_decoder_layers)],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.LayerNorm(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.Select([</span><span class=\"mtk4\">0</span><span class=\"mtk1\">], </span><span class=\"mtk19 mtki\">n_in</span><span class=\"mtk7\">=</span><span class=\"mtk4\">3</span><span class=\"mtk1\">),  </span><span class=\"mtk3\"># Drops masks and encoding vectors.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Map vectors to match output vocab size.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      tl.Dense(output_vocab_size),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  )</span></span></span></code></pre>\n<p><code>Transformer</code> ëŠ” ì¸ì½”ë”ì— ì…ë ¥ë˜ëŠ” í† í°ê³¼ ë””ì½”ë”ì— ì…ë ¥ë˜ëŠ” í† í° ìŒ <code>(tok_d, tok_e)</code>ë¥¼ ì…ë ¥ë°›ì•„ ë””ì½”ë” ë²¡í„°ì™€ ë””ì½”ë” í† í° ìŒ <code>(vec_d, tok_d)</code>ë¥¼ ë°˜í™˜í•œë‹¤. <code>tl.Branch</code>ë¡œ ì…ë ¥ê°’ê³¼ íŒ¨ë”©ë§ˆìŠ¤í¬ë¥¼ ìƒì„±í•œ í›„ <code>_Encoder()</code>ë¡œ ì¸ì½”ë”©ì„ ì‹¤í–‰í•œë‹¤. <code>_Encoder</code>ëŠ” <code>n_encoder_layers</code>ê°œì˜ ì¸ì½”ë” ë¸”ëŸ­ <code>_EncoderDecoderBlock</code>ì„ í¬í•¨í•˜ë„ë¡ ì •ì˜ë˜ì–´ ìˆë‹¤. ì¸ì½”ë”©ì„ ê±°ì¹˜ë©´ ë°ì´í„°ëŠ” <code>(vec_e, masks, tok_d)</code>ê°€ ë˜ë©° <code>tl.Select</code>ë¡œ ìˆœì„œë¥¼ ë’¤ì§‘ì–´ teacher forcingê³¼ positional encodingì„ ì‹¤í–‰í•œë‹¤. ë‘ë²ˆì§¸ <code>tl.Branch</code>ë¡œ <code>(tok_d, masks)</code>ë¥¼ ì¸ì½”ë”-ë””ì½”ë” ë¸”ëŸ­ì— ì…ë ¥í•˜ë©°, ì´ ì™¸ì˜ ê°’ë“¤ì€ ì´í›„ <code>tl.Select</code>ë¡œ ì œì™¸ì‹œí‚¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. <code>_EncoderDecoderBlock</code>ì€ ì•ì—ì„œ ì‚´í´ë³¸ ëŒ€ë¡œë‹¤. ì´ë¡œì¨ <code>Transformer</code>í•¨ìˆ˜ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒë§Œìœ¼ë¡œ  íŠ¸ëœìŠ¤í¬ë¨¸ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.</p>\n<br>\n<br>\n<h2>ë‚˜ê°€ë©°</h2>\n<p>ì—¬ëŸ¬ ë‚´ìš©ì„ ë‹¤ë£¨ë‹¤ë³´ë‹ˆ ê¸€ì´ ê¸¸ì–´ì¡Œë‹¤. íŠ¸ëœìŠ¤í¬ë¨¸ ëª¨ë¸ì€ ê¸´ ì‹œí€€ìŠ¤ì—ì„œ ë§¥ë½ì„ ì¶”ì¶œí•˜ëŠ”ë°ì— ì‚¬ìš©ë˜ëŠ” ëª¨ë¸ë¡œ ë„ë¦¬ ì“°ì´ê³  ìˆì§€ë§Œ, ì§§ì€ ì‹œí€€ìŠ¤ë¥¼ ë¶„ì„í•˜ê±°ë‚˜ ë§¥ë½ì„ êµ¬í•˜ê¸° ì–´ë ¤ìš´ ë¬¸ì œì— ëŒ€í•´ì„œëŠ” ì í•©í•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤. í•œí¸ìœ¼ë¡œëŠ” íŠ¸ëœìŠ¤í¬ë¨¸ ëª¨ë¸ì„ ì´ë¯¸ì§€ì— ì ìš©í•œ ì‚¬ë¡€ë‚˜ ë‹¤ì–‘í•œ ê³¼ì œë¥¼ í•œë²ˆì— ìˆ˜í–‰í•˜ëŠ” T5, ë” ê¸´ ì‹œí€€ìŠ¤ì— ëŒ€í•´ íš¨ìœ¨ì (<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>N</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>N</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(NlogN)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">Nl</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mclose\">)</span></span></span></span></span>)ìœ¼ë¡œ í•™ìŠµí•˜ëŠ” ë¦¬í¬ë¨¸ ëª¨ë¸ ë“± ë‹¤ì–‘í•œ ë²„ì „ì´ ë“±ì¥í•˜ê³  ìˆìœ¼ë¯€ë¡œ, íŠ¸ëœìŠ¤í¬ë¨¸ì˜ ê¸°ë³¸ì ì¸ êµ¬ì¡°ë¥¼ ì´í•´í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•  ê²ƒì´ë‹¤.</p>\n<p>ê¸€ë¡œ ì •ë¦¬í•˜ë©´ì„œ ë‚˜ì˜ ë§¹ì ì— ëŒ€í•´ ì•Œ ìˆ˜ ìˆì—ˆë‹¤. Residualì´ ì™œ í•„ìš”í•œì§€, ì¸ì½”ë”ë‚˜ ë””ì½”ë” ë¸”ëŸ­ì„ ì™œ ì—¬ëŸ¬ë²ˆ ì‹¤í–‰í•˜ëŠ”ì§€, ì–´í…ì…˜ì—ì„œ í•™ìŠµí•˜ëŠ” íŒŒë¼ë¯¸í„°ëŠ” ì–´ëŠ ë¶€ë¶„ì¸ì§€ ìƒê°í•˜ì§€ ì•Šê³  ë„˜ê¸°ë‹¤ê°€ ë…¼ë¬¸ì„ ì½ìœ¼ë©´ì„œ ì €ìì˜ ì˜ë„ì™€ historyë¥¼ ì¡°ê¸ˆ ë” ì´í•´í•  ìˆ˜ ìˆì—ˆë‹¤. ë˜ ê¸€ì„ ì“°ë©´ì„œ Trax ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì½”ë“œë¥¼ ë¶€ë¶„ì ìœ¼ë¡œ ë“¤ì—¬ë‹¤ë´¤ë‹¤. <code>Select()</code>ë‚˜ <code>Residual()</code>, <code>Branch()</code>ë¡œ ë ˆì´ì–´ë¥¼ ìŒ“ëŠ” ë¶€ë¶„ì€ ê·¸ë¦¼ì´ ìì—°ìŠ¤ëŸ½ê²Œ ë– ì˜¤ë¥´ëŠ” ê°œë…ì„ ì½”ë“œë¡œ í‘œí˜„í•´ ì§ê´€ì ì´ë¼ëŠ” ëŠë‚Œì´ ë“¤ì—ˆê³ , ì¸ì½”ë”ë‚˜ ë””ì½”ë”ì˜ ì¼ë¶€ë¶„ì„ ë”°ë¡œ ë–¼ì–´ì„œ ì‚¬ìš©í•˜ëŠ” ê°ê°ì˜ í•¨ìˆ˜ê°€ ìˆì–´ ì‚¬ìš© í¸ì˜ë¥¼ ê³ ë ¤í•œ ì ì´ ëŠê»´ì¡Œë‹¤. í° í”„ë¡œê·¸ë¨(ë¼ì´ë¸ŒëŸ¬ë¦¬)ì˜ ì½”ë“œì´ë‹¤ë³´ë‹ˆ ì¬ì‚¬ìš©ë˜ëŠ” ë¶€ë¶„ê³¼ ì¡°ê¸ˆì”© ì°¨ì´ë‚˜ëŠ” ë¶€ë¶„, íŠ¹íˆ ë©”ì„œë“œì˜ ì˜ì¡´ë„ë¥¼ ë¯¸ë¦¬ ë””ìì¸í•´ì„œ í° ê·¸ë¦¼ì„ ì—¼ë‘ì— ë‘ê³  í”„ë¡œê·¸ë¨ì„ ì‘ì„±í–ˆë‹¤ëŠ” ì ì´ ëŠê»´ì¡Œë‹¤. ê²°êµ­ ì´ë¡ ê³¼ êµ¬í˜„ì´ ëª¨ë‘ ì¤‘ìš”í•˜ê³  ë‚˜ë¦„ì˜ ê¹Šì´ê°€ ìˆë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆë‹¤.</p>\n<br>\n<br>\n<h2>ì°¸ê³  ìë£Œ</h2>\n<ol>\n<li>Natural Language Processing with Attention Models, deeplearning.ai, Coursera, <a href=\"https://www.coursera.org/specializations/natural-language-processing\">https://www.coursera.org/specializations/natural-language-processing</a></li>\n<li>Trax Library for Machine Learning, Github, <a href=\"https://github.com/google/trax\">https://github.com/google/trax</a></li>\n<li>Transformers, Google AI blog, <a href=\"https://ai.googleblog.com/2017/08/transformer-novel-neural-network.html\">https://ai.googleblog.com/2017/08/transformer-novel-neural-network.html</a></li>\n<li>Vaswani et al, 2017, <a href=\"https://arxiv.org/abs/1706.03762\">https://arxiv.org/abs/1706.03762</a></li>\n<li>Jay Alammar on Github page, <a href=\"https://jalammar.github.io/illustrated-transformer/\">https://jalammar.github.io/illustrated-transformer/</a></li>\n</ol>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .abyss { background-color: #000c18; }\n  .abyss .mtku {\n    text-decoration: underline;\n    text-underline-position: under;\n  }\n  .abyss .mtki { font-style: italic; }\n  .abyss .mtk15 { color: #9966B8; }\n  .abyss .mtk1 { color: #6688CC; }\n  .abyss .mtk6 { color: #DDBB88; }\n  .abyss .mtk19 { color: #2277FF; }\n  .abyss .mtk7 { color: #225588; }\n  .abyss .mtk4 { color: #F280D0; }\n  .abyss .mtk11 { color: #22AA44; }\n  .abyss .mtk3 { color: #384887; }\n  .abyss .mtk5 { color: #FFEEBB; }\n  .abyss .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","frontmatter":{"title":"[Paper/Trax] Transformer, 2017","date":"April 14, 2022"}}},"pageContext":{"slug":"/AI/NLP/transformer/","previous":{"fields":{"slug":"/AI/NLP/naive-bayes/"},"frontmatter":{"title":"í…ìŠ¤íŠ¸ ë‚˜ì´ë¸Œ ë² ì´ì¦ˆ ë¶„ë¥˜"}},"next":{"fields":{"slug":"/AI/NLP/siamese-nn/"},"frontmatter":{"title":"[Paper] Siamese Neural Network, 2015"}}}},"staticQueryHashes":["1185972000","3231742164"],"slicesMap":{}}