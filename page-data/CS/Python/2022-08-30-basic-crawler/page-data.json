{"componentChunkName":"component---src-templates-blog-post-js","path":"/CS/Python/2022-08-30-basic-crawler/","result":{"data":{"allMarkdownRemark":{"totalCount":30},"markdownRemark":{"id":"5a1de05b-d981-5448-8d38-3f0b072b525b","html":"<p>웹 크롤링은 재귀적으로 페이지에서 URL을 찾아 다시 페이지를 불러오는 작업을 반복한다. 스크레이퍼는 모든 데이터가 페이지 하나에 들어 있는 경우에는 잘 동작하지만, 크롤러를 사용할 때는 대역폭에 주의를 기울여 타깃 서버의 부하를 줄일 방법을 강구해야 한다.</p>\n<br>\n<br>\n<h2>1. 단일 도메인 탐색하기</h2>\n<p>Wikipedia의 HTML 텍스트를 가져오는 프로그램을 작성해 보자.</p>\n<ul>\n<li>위키백과 데이터를 사용하는 대규모 프로젝트를 계획하는 경우, 위키백과 API(<a href=\"https://www.mediawiki.org/wiki/API:Main_page)%EB%A5%BC\">https://www.mediawiki.org/wiki/API:Main_page)를</a> 통해 얻을 수 있는 데이터인지 확인하자. 위키 API를 통해 크롤링보다 효율적으로 데이터를 얻을 수 있다.</li>\n</ul>\n<p>다음은 특정 위키백과 페이지에 들어있는 링크 목록을 가져오는 코드이다.</p>\n<pre class=\"grvsc-container abyss\" data-language=\"python\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">from</span><span class=\"mtk1\"> urllib.request </span><span class=\"mtk7\">import</span><span class=\"mtk1\"> urlopen</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">from</span><span class=\"mtk1\"> urllib.error </span><span class=\"mtk7\">import</span><span class=\"mtk1\"> HTTPError, URLError</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">from</span><span class=\"mtk1\"> bs4 </span><span class=\"mtk7\">import</span><span class=\"mtk1\"> BeautifulSoup</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">import</span><span class=\"mtk1\"> datetime</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">import</span><span class=\"mtk1\"> random</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">import</span><span class=\"mtk1\"> re</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Get different random seed everytime program starts</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">random.seed(datetime.datetime.now())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">getLinks</span><span class=\"mtk1\">(</span><span class=\"mtk19 mtki\">articleUrl</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">&quot;&quot;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">    Inputs:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">        articleUrl : Url in &#39;wiki/...&#39; form</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">    Outputs:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">        List of all URLs in a page of form &#39;wiki/{articleUrl}&#39; </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">    &quot;&quot;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Get HTML text</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">try</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        html </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> urlopen(</span><span class=\"mtk15 mtki\">f</span><span class=\"mtk11\">&#39;https://en.wikipedia.org/</span><span class=\"mtk4\">{</span><span class=\"mtk1\">articleUrl</span><span class=\"mtk4\">}</span><span class=\"mtk11\">&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">except</span><span class=\"mtk1\"> HTTPError </span><span class=\"mtk7\">as</span><span class=\"mtk1\"> e:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">print</span><span class=\"mtk1\">(e)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">except</span><span class=\"mtk1\"> URLError </span><span class=\"mtk7\">as</span><span class=\"mtk1\"> e:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">print</span><span class=\"mtk1\">(</span><span class=\"mtk11\">&#39;The server could not be found!&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">else</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">print</span><span class=\"mtk1\">(</span><span class=\"mtk11\">&#39;Got HTML successfully.&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Parse HTML text and create bs</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    bs </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> BeautifulSoup(html.read(). </span><span class=\"mtk11\">&#39;html.parser&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Among tags that contain &#39;div&#39; and &#39;id&#39;, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># return list of URLs that matchs regular expression pattern.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> bs.find(</span><span class=\"mtk11\">&#39;div&#39;</span><span class=\"mtk1\">, {</span><span class=\"mtk11\">&#39;id&#39;</span><span class=\"mtk1\">:</span><span class=\"mtk11\">&#39;bodyContent&#39;</span><span class=\"mtk1\">}).findAll(</span><span class=\"mtk11\">&#39;a&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk19 mtki\">href</span><span class=\"mtk7\">=</span><span class=\"mtk1\">re.compile(</span><span class=\"mtk11\">&#39;^(wiki/)((?!:).)*$&#39;</span><span class=\"mtk1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Get search keyword</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">print</span><span class=\"mtk1\">(</span><span class=\"mtk11\">&#39;Type keyword to search URL links recursively in wiki.&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">target </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk15 mtki\">str</span><span class=\"mtk1\">(</span><span class=\"mtk15\">input</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Get every URL on a page and pick one random URL to print the page.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Repeat while there are no URLs in the searched page.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">links </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> getLinks(</span><span class=\"mtk11\">&#39;wiki/</span><span class=\"mtk4\">{target}</span><span class=\"mtk11\">&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">while</span><span class=\"mtk1\"> </span><span class=\"mtk15\">len</span><span class=\"mtk1\">(links) </span><span class=\"mtk7\">&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk4\">0</span><span class=\"mtk1\">: </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    newArticle </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> links[random.randint(</span><span class=\"mtk4\">0</span><span class=\"mtk1\">, </span><span class=\"mtk15\">len</span><span class=\"mtk1\">(links)</span><span class=\"mtk7\">-</span><span class=\"mtk4\">1</span><span class=\"mtk1\">)].attrs[</span><span class=\"mtk11\">&#39;href&#39;</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">print</span><span class=\"mtk1\">(newArticle)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    links </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> getLinks(newArticle)</span></span></span></code></pre>\n<br>\n<br>\n<h2>2. 전체 사이트 크롤링하기</h2>\n<h3>스크랩이 가능한 웹 페이지들</h3>\n<ul>\n<li>표면 웹(Surface Web) : 검색엔진에서 저장하는 부분이다.</li>\n<li>딥 웹(Deep Web) : 표면 웹의 나머지 부분으로, 인터넷의 90% 정도를 차지한다. 딥웹은 링크되지 않은 페이지나 robots.txt로 차단된 페이지들을 포함하지만, 일부분은 스크랩이 가능하다.\n<ul>\n<li>robots.txt 파일은 크롤러 트래픽을 관리하기 위해 사용되며, 사이트에서 접근가능한 URL을 검색엔진 크롤러에 알려준다.</li>\n</ul>\n</li>\n<li>다크 웹(Dark Web) : 딥 웹의 일부분으로, 기존 네트워크 하드웨어 인프라에서 작동하긴 하지만 접근하기 위해 익명 클라이언트 Tor등 특정 프로그램이나 방법을 요구한다. HTTP 위에서 동작하며 보안 채널로 정보를 교환하는 앱 프로토콜을 사용한다. 다크웹을 스크랩하는 데에는 표면 웹을 스크랩하는 것과 다른 방법이 필요하다.\n<ul>\n<li>Tor(The Onion Router)는 네트워크 우회를 통해 네트워크 익명화를 시행하는 프로그램이다.</li>\n</ul>\n</li>\n</ul>\n<br>\n<h3>웹사이트 전체 크롤링이 유용한 경우</h3>\n<ul>\n<li>사이트맵 생성 : 크롤러를 통해 사이트 전체를 이동하면서 내부링크를 수집해 페이지들을 폴더구조와 같이 정리할 수 있다. 이를 통해 웹사이트 설계 비용등을 계산할 수 있다.</li>\n<li>데이터 수집 : 특정 페이지(예를 들어 블로그 포스트나 뉴스 기사 페이지)에 국한해서 검색 플랫폼의 프로토타입을 생성할 때도 재귀적인 크롤링을 이용할 수 있다.</li>\n</ul>\n<br>\n<h3>전체 사이트 크롤링에서 중복 피하기</h3>\n<p>페이지당 내부 링크가 10개씩 있고 사이트가 다섯 단계로 구성되어있다고 하자. 페이지를 철저히 탐색하기 위해서는 최소 <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>105</mn></mrow><annotation encoding=\"application/x-tex\">105</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">105</span></span></span></span></span> 페이지에서 <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span></span> 페이지를 탐색해 한다. 그렇지만 실제로 내부 링크 중 중복이 많기 때문에 <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span></span> 페이지를 탐색해야하는 경우는 거의 없다.</p>\n<p>즉 전체 사이트를 크롤링하는 프로그램은 중복 방문을 하지 않는 것이 중요하다. 같은 페이지를 두 번 크롤링하지 않기 위해서는 발견하는 내부 링크를 일정한 형식을 따르도록 해서 집합(Set)에 보관할 수 있다.</p>\n<pre class=\"grvsc-container abyss\" data-language=\"python\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># 웹 페이지 중복을 피하기 위해 집합으로 방문한 링크를 관리한다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">pages </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk15 mtki\">set</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">printLinks</span><span class=\"mtk1\">(</span><span class=\"mtk19 mtki\">pageUrl</span><span class=\"mtk1\">, </span><span class=\"mtk19 mtki\">recur_cnt</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">&quot;&quot;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">    위키백과 사이트에서 내부 링크를 100번 재귀 탐색한다. </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">    &quot;&quot;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># 재귀 횟수를 100번으로 제한한다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    recur_cnt </span><span class=\"mtk7\">+=</span><span class=\"mtk1\"> </span><span class=\"mtk4\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> recur_cnt </span><span class=\"mtk7\">&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk4\">100</span><span class=\"mtk1\">: </span><span class=\"mtk7\">return</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># 프로그램이 동작하는 동안 집합이 유지되도록 한다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">global</span><span class=\"mtk1\"> pages</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># 위키피디아에서 pageUrl을 검색한다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">try</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        html </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> urlopen(</span><span class=\"mtk15 mtki\">f</span><span class=\"mtk11\">&#39;http://en.wikipedia.org/</span><span class=\"mtk4\">{</span><span class=\"mtk1\">pageUrl</span><span class=\"mtk4\">}</span><span class=\"mtk11\">&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">except</span><span class=\"mtk1\"> HTTPError </span><span class=\"mtk7\">as</span><span class=\"mtk1\"> e:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">print</span><span class=\"mtk1\">(e)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">except</span><span class=\"mtk1\"> URLError </span><span class=\"mtk7\">as</span><span class=\"mtk1\"> e:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">print</span><span class=\"mtk1\">(</span><span class=\"mtk11\">&#39;The server could not be found!&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">else</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">print</span><span class=\"mtk1\">(</span><span class=\"mtk11\">&#39;Got HTML successfully.&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    bs </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> BeautifulSoup(html.read(), </span><span class=\"mtk11\">&#39;html.parser&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># 페이지의 모든 &#39;wiki/...&#39; URL을 탐색하여 출력한다. </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">for</span><span class=\"mtk1\"> link </span><span class=\"mtk7\">in</span><span class=\"mtk1\"> bs.findAll(</span><span class=\"mtk11\">&#39;a&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk19 mtki\">href</span><span class=\"mtk7\">=</span><span class=\"mtk1\">re.compile(</span><span class=\"mtk11\">&#39;^(&#39;</span><span class=\"mtk1\">wiki</span><span class=\"mtk7\">/</span><span class=\"mtk11\">&#39;)&#39;</span><span class=\"mtk1\">)):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&#39;href&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">in</span><span class=\"mtk1\"> link.attrs:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> link.attrs[</span><span class=\"mtk11\">&#39;href&#39;</span><span class=\"mtk1\">] </span><span class=\"mtk7\">not</span><span class=\"mtk1\"> </span><span class=\"mtk7\">in</span><span class=\"mtk1\"> pages:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3\"># 새로운 페이지를 탐색한다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                newPage </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> link.attr[</span><span class=\"mtk11\">&#39;href&#39;</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">print</span><span class=\"mtk1\">(newPage)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                pages.add(newPage)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                printLinks(newPage)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># getLinks 함수를 재귀적으로 호출한다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Python의 재귀 깊이는 1000회로 제한되어 있으므로, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># 위키백과 같이 큰 링크 네트워크를 탐색할 때는 재귀 횟수를 제한하도록 한다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">printLinks(</span><span class=\"mtk11\">&#39;&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">1</span><span class=\"mtk1\">)</span></span></span></code></pre>\n<br>\n<h3>전체 사이트에서 데이터 수집하기</h3>\n<p>단순히 URL을 출력하는 것 외에 페이지의 다양한 데이터를 수집해보자.</p>\n<pre class=\"grvsc-container abyss\" data-language=\"python\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">pages </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk15 mtki\">set</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk6\">printSummary</span><span class=\"mtk1\">(</span><span class=\"mtk19 mtki\">pageUrl</span><span class=\"mtk1\">, </span><span class=\"mtk19 mtki\">recur_cnt</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">&quot;&quot;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">    위키백과 사이트에서 내부링크를 탐색하며 페이지 제목과 첫번째 문단, 편집 링크를 출력한다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">    &quot;&quot;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    recur_cnt </span><span class=\"mtk7\">+=</span><span class=\"mtk1\"> </span><span class=\"mtk4\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> recur_cnt </span><span class=\"mtk7\">&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk4\">100</span><span class=\"mtk1\">: </span><span class=\"mtk7\">return</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">global</span><span class=\"mtk1\"> pages</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    html </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> urlopen(</span><span class=\"mtk15 mtki\">f</span><span class=\"mtk11\">&#39;http://en.wikipedia.org/</span><span class=\"mtk4\">{</span><span class=\"mtk1\">pageUrl</span><span class=\"mtk4\">}</span><span class=\"mtk11\">&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    bs </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> BeautifulSoup(html.read(), </span><span class=\"mtk11\">&#39;html.parser&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">try</span><span class=\"mtk1\">: </span><span class=\"mtk3\"># 다음을 모두 수행하는 경우 항목 페이지이다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\"># 페이지 제목을 출력한다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">print</span><span class=\"mtk1\">(bs.h1.get_text())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\"># 첫 번째 문단을 출력한다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\"># div#mw-content-text -&gt; p에서 첫번째 문단 태그만 선택한다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">print</span><span class=\"mtk1\">(bs.find(</span><span class=\"mtk19 mtki\">id</span><span class=\"mtk7\">=</span><span class=\"mtk11\">&#39;mw-context-text&#39;</span><span class=\"mtk1\">).findall(</span><span class=\"mtk11\">&#39;p&#39;</span><span class=\"mtk1\">)[</span><span class=\"mtk4\">0</span><span class=\"mtk1\">])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\"># 편집 링크를 출력한다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\"># li#ca-edit -&gt; span -&gt; a로 탐색한다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">print</span><span class=\"mtk1\">(bs.find(</span><span class=\"mtk19 mtki\">id</span><span class=\"mtk7\">=</span><span class=\"mtk11\">&#39;ca-edit&#39;</span><span class=\"mtk1\">).find(</span><span class=\"mtk11\">&#39;span&#39;</span><span class=\"mtk1\">).find(</span><span class=\"mtk11\">&#39;a&#39;</span><span class=\"mtk1\">).attrs[</span><span class=\"mtk11\">&#39;href&#39;</span><span class=\"mtk1\">])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">except</span><span class=\"mtk1\"> </span><span class=\"mtk15 mtki\">AttributeError</span><span class=\"mtk1\">: </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">print</span><span class=\"mtk1\">(</span><span class=\"mtk11\">&#39;This page is not a content page!&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">for</span><span class=\"mtk1\"> link </span><span class=\"mtk7\">in</span><span class=\"mtk1\"> bs.findAll(</span><span class=\"mtk11\">&#39;a&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk19 mtki\">href</span><span class=\"mtk7\">=</span><span class=\"mtk1\">re.compile(</span><span class=\"mtk11\">&#39;^(&#39;</span><span class=\"mtk1\">wiki</span><span class=\"mtk7\">/</span><span class=\"mtk11\">&#39;)&#39;</span><span class=\"mtk1\">)):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&#39;href&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">in</span><span class=\"mtk1\"> link.attrs:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> link.attrs[</span><span class=\"mtk11\">&#39;href&#39;</span><span class=\"mtk1\">] </span><span class=\"mtk7\">not</span><span class=\"mtk1\"> </span><span class=\"mtk7\">in</span><span class=\"mtk1\"> pages:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                newPage </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> link.attrs[</span><span class=\"mtk11\">&#39;href&#39;</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">print</span><span class=\"mtk1\">(</span><span class=\"mtk11\">&#39;-&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">*</span><span class=\"mtk1\"> </span><span class=\"mtk4\">30</span><span class=\"mtk1\"> </span><span class=\"mtk7\">+</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&#39;</span><span class=\"mtk4\">\\n</span><span class=\"mtk11\">&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">+</span><span class=\"mtk1\"> newPage)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                pages.add(newPage)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                getLinks(newPage)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">printSummary(</span><span class=\"mtk11\">&#39;&#39;</span><span class=\"mtk1\">)</span></span></span></code></pre>\n<br>\n<br>\n<h2>3. 인터넷 크롤링하기</h2>\n<h3>웹 크롤러를 만드는데에 고려할 사항들</h3>\n<ul>\n<li>정해진 사이트 몇 개만 수집하는 것인지, 아니면 있는지도 몰랐던 사이트에 방문하는 크롤러가 필요한 것인지 질문한다.</li>\n<li>크롤러가 특정 웹사이트에 도달했을 때, 사이트의 정보를 탐색할지 다른 링크를 따라갈지 고려한다.</li>\n<li>제외할 사이트는 없는지 고려한다. 예를 들어, 언어권이 다른 경우나 특정 컨텐츠를 포함하면 재귀를 종료할만한지 고려한다.</li>\n<li>방문할 가능성이 있는 웹사이트에 크롤러가 방문하는 것이 합법적인지 고려한다.</li>\n</ul>\n<br>\n<h3>웹 크롤러 작성하기</h3>\n<p>웹 크롤러의 코드는 전체 사이트를 탐색하는 코드와 유사하다. 다만 탐색 한계를 명시하고 예외 사항을 처리해야 실무에 활용할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 672px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB7UlEQVR42o1Ti3KaQBTN/39SYzst2jD1QQUhiDyjIg0YBB88BD2ZeyM0ZmKnd2bZZXf23HPPPXt3Pp9BUdc1losFfN9HEKzgeR7yPOezJEmwXC5xOBz4P01ThGGI9XqNKIoQhSEanDv6nE4neI4D4cd3fPvaQef+Czqde1iWhZkxRb/fhz7VIYoPmBkGNFWFrusYDofo939BURQcq+ovYJZlnJVYTBSFh23biOOYkwVBgMFgANdx+FL4/AzTNDmhYRhwXfeaIZVS128ZaF0WBZqoqgpZdsBsOsV2u2VpbgWBtoDH45E3y7LEbrflmYCenjxmoWkas3Ycu738cVwxbAAZtChYBtp3HAeqqmIyURiUyvwvwOoi6scg4G2assZpmlwlvllynmXImI0N13XYMsZFM4rNZsMN2+/3OJYlW2W18vEnCNhmvr+8ZljkOTOQpBF6vS66goBetwvLMjHVH9kuZA1BEGBbJiaKjPF4DEWR2TaiKLbNam1DDBeLBX5LEuTxmNk2RiaGsiyzfSjITqQl2YUaNZ/PcX6r+b1t6tYm1UUnKoPK3MQx9EcN6yhqX88/NWw6SqBFUTBAkmwQv7xwdnoVva4A0zKZUfO6bnaZDonJfr/jmcqnQWvPdTEajSA+/IQkSdywz2zTxCtoDtiDVu6LUQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"flow of crawler\"\n        title=\"\"\n        src=\"/static/981ec0529f102205b21fa6e276eff697/30d16/flow-of-crawler.png\"\n        srcset=\"/static/981ec0529f102205b21fa6e276eff697/5a46d/flow-of-crawler.png 300w,\n/static/981ec0529f102205b21fa6e276eff697/0a47e/flow-of-crawler.png 600w,\n/static/981ec0529f102205b21fa6e276eff697/30d16/flow-of-crawler.png 672w\"\n        sizes=\"(max-width: 672px) 100vw, 672px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>Flow of a crawler searching every outer link of a website.</p>\n<p>위는 웹 크롤러 논리의 한 예이다. 크게 두 개의 루프가 있다고 할 때, 아래의 루프는 페이지 내의 외부 링크를 탐색하고, 외부 링크가 없는 경우에는 내부 링크를 탐색하여 리스트에 추가한다.</p>\n<br>\n<br>\n<h2>참고 자료</h2>\n<ul>\n<li>『파이썬으로 웹 크롤러 만들기(Web Scraping with Python)』, 라이언 미첼(Ryan Mitchell)</li>\n</ul>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .abyss { background-color: #000c18; }\n  .abyss .mtki { font-style: italic; }\n  .abyss .mtk7 { color: #225588; }\n  .abyss .mtk1 { color: #6688CC; }\n  .abyss .mtk3 { color: #384887; }\n  .abyss .mtk15 { color: #9966B8; }\n  .abyss .mtk6 { color: #DDBB88; }\n  .abyss .mtk19 { color: #2277FF; }\n  .abyss .mtk11 { color: #22AA44; }\n  .abyss .mtk4 { color: #F280D0; }\n  .abyss .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","frontmatter":{"title":"python 크롤링 - 기초 크롤러","date":"August 30, 2022"}}},"pageContext":{"slug":"/CS/Python/2022-08-30-basic-crawler/","previous":{"fields":{"slug":"/CS/Python/2022-08-30-beautifulsoup/"},"frontmatter":{"title":"python 크롤링 - beautifulsoup 모듈"}},"next":{"fields":{"slug":"/AI/Vision/image-style-transfer/"},"frontmatter":{"title":"[Paper] Image Style Transfer, 2016"}}}},"staticQueryHashes":["1185972000","3231742164"],"slicesMap":{}}